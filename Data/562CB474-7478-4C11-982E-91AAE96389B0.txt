 2 
è¡Œæ”¿é™¢åœ‹å®¶ç§‘å­¸å§”å“¡æœƒå°ˆé¡Œç ”ç©¶è¨ˆç•«æˆæœå ±å‘Š 
è¨ˆç•«åç¨±ï¼šç•°è³ªç„¡ç·šç¶²è·¯ä¹‹é«˜å“è³ªè¦–è¨Šå‚³è¼¸æŠ€è¡“èˆ‡æœå‹™ -- å­è¨ˆç•«äº”ï¼šç•°è³ªç„¡
ç·šç¶²è·¯ä¸Šè·¨å±¤æ¬¡é»å°é»è¦–è¨Šå‚³è¼¸æœ€é©åŒ–æŠ€è¡“ç ”ç©¶ 
è¨ˆç•«ç·¨è™Ÿï¼š 
å­è¨ˆç•«ä¸»æŒäººï¼šåœ‹ç«‹æ¸…è¯å¤§å­¸ é›»æ©Ÿå·¥ç¨‹å­¸ç³» æ—å˜‰æ–‡ 
å­è¨ˆç•«åƒèˆ‡äººå“¡ï¼š ç¾…å•“æ–‡ã€å»–å¤©ä½‘ã€è”¡ä½³éŠ˜ 
æ‘˜è¦ 
 
æœ¬(99)å¹´åº¦çš„ç ”ç©¶ä¸­çµåˆäº† forward error correction(FEC)èˆ‡ç¯€é»é¸æ“‡æ³•æå‡ºä¸€å€‹å°åŒ…ä¿è­·æ©Ÿåˆ¶ï¼Œå¯ä»¥æœ€
å°åŒ–ç¶²ç‹€ P2P è¦–è¨Šç³»çµ±ä¸­çš„å°åŒ…éºå¤±ç‡ã€‚çˆ¶ç¯€é»å¯ä»¥é¸æ“‡å­ç¯€é»ä¾†å‚³é€ FEC å†—é¤˜å°åŒ…ä¾†é™ä½å­ç¯€é»çš„
å°åŒ…éºå¤±ç‡ï¼Œè¢«é¸æ“‡çš„å­ç¯€é»è¦èƒ½å¤ è·Ÿå…¶ä»–å€™é¸çš„å­ç¯€é»é™ä½æ›´å¤šçš„å°åŒ…éºå¤±ç‡ã€‚æ­¤å¤–ï¼Œæœ¬ç ”ç©¶æå‡º
ä¸€å€‹å°åŒ…éºå¤±æ©Ÿç‡æ¨¡å‹ï¼Œç”¨ä¾†åˆ†æå°åŒ…éºå¤±åœ¨ç¶²ç‹€ P2P ç¶²è·¯çš„å‚³éï¼Œä¸¦åˆ©ç”¨ Markov random field çš„ç‰¹
æ€§ä¾†ç°¡åŒ–åˆ†æã€‚æ¨¡æ“¬çµæœå…ˆæ˜¯å‡ºæœ¬ç ”ç©¶æå‡ºçš„æ–¹æ³•å¯ä»¥æœ‰æ•ˆçš„é™ä½ P2P è¦–è¨Šä¸²æµçš„å°åŒ…éºå¤±ç‡ã€‚ 
é—œéµå­—ï¼šéŒ¯èª¤ä¿è­·ã€P2P è¦–è¨Šã€ç¯€é»é¸æ“‡ã€å‰å‘éŒ¯èª¤æ›´æ­£ 
Abstract 
This research proposes a distributed packet protection mechanism that can minimize the packet loss 
probability for mesh based P2P video streaming systems. The proposed scheme combines a peer selection 
method with forward error correction (FEC) codes. The parent peers select the child peers, which can achieve 
the minimal packet loss probability compared to other candidate child peers, to transmit the FEC redundant 
substream. Moreover, the proposed scheme utilizes a packet loss model to estimate the packet loss probability 
in a mesh based P2P network. The packet loss propagation among peers is modeled through Markov random 
field (MRF). Simulation results demonstrate that our scheme can effectively mitigate packet loss in a 
mesh-based P2P network. 
 
Key words: Error protection, P2P video streaming system, peer selection, FEC 
 
 4 
GOPs compose the video substreams. As shown in Fig. 1, video 
substream 1 contains the first packets from GOP #1 through GOP #N.  
During a streaming session, the child-peers request their parent-peers 
for the video substreams (i.e., a pull process). Once the parent-peers 
accept the requests, the parent-peers continuously push the 
corresponding packets to their child peers, as known as the push-pull 
methods [4]. 
...
...
...
...
...
...
GOP #1
GOP #2
GOP #3
GOP #N
Substream 1
Substream k+1
Substream n
...
...
...
...
 
Fig. 1. Data protection with FEC(n,k), where white blocks indicate the 
data packets and the grey ones indicate FEC redundant blocks. 
When a new peer joins the P2P system, it starts contacting the 
bootstrap server to obtain the live peer list. Then the new peer requests 
at least k data substreams from the peers in the live peer list. Besides 
the k data substreams, the peer also requests additional redundant 
substreams to reduce the possibility of packet loss during video 
transmissions by sending the request to parent-peer x that can offer the 
redundant substreams, and is added into the candidate set ğ‚ğ‘¥ of peer 
x. If the uplink capacity of peer x cannot afford the demands of all 
peers in ğ‚ğ‘¥, those â€œlow-contributionâ€ candidate peers will be rejected. 
The contribution of a candidate peer is measured by the energy 
function defined in (12).  
Let ry be the number of redundant substreams received by peer y, 
ny = k + ry + Ïƒxy be the total number of substreams expected to be 
received by peer y, where Ïƒxy is the activity of the link between 
parent-peer x and candidate child-peer y. If peer x accepts peer y as its 
child-peer, Ïƒxy = 1; otherwise, Ïƒxy = 0. We use the set of random 
variable ?Ì…? = {ğœğ‘¥ğ‘¦|ğ‘¥ âˆˆ ?Ì…?, ğ‘¦ âˆˆ ?Ì…?ğ‘¥}  to represent the topological 
configuration among peers, where ?Ì…? denotes the set of live peers. 
The configuration constitutes a topology that describes the 
interrelation of packet transport among peers.  
 3. PROPOSED PEER SELECTION SCHEME 
 
We investigate the peer interrelations in mesh networks in terms of 
packet loss probability and propose a scheme for finding the optimal 
configuration that can minimize packet loss probability. 
3.1. The Packet Loss Models 
The packet loss models proposed in [3] can be used to estimate the 
packet loss probability of the peers at depth D in a tree, denoted as QD. 
In this model, the packet loss caused by the following four events are 
taken into considerations: 1) peer arrival/departure behavior described 
by a continuous-time Markov chain (CTMC), 2) FEC coding pattern, 
3) packet drop rate of the channel, and 4) packet loss probability of 
the parent-peers at depth Dï€­1. These events are denoted as Pi, 
FEC(n,k), d, and QDï€­1, respectively. However, unlike the case in a 
tree-based network, peers in a mesh-based network do not belong to 
specific levels/depths. Furthermore, each peer suffers from different 
packet loss conditions. Thus, the derivation of packet loss models of a 
peer for a mesh-based network is much more complex. In what 
follows, we briefly summarize the tree- based packet loss models 
derived in [3]. 
The packet loss probability of candidate peer y that has received ry 
substreams and requests one more redundant substream from peer x 
can be formulated as [3] 
ğ‘„ğ‘¦(ğ‘Ÿğ‘¦ + ğœğ‘¥ğ‘¦) = âˆ‘ ğ‘ƒğ‘–
ğ‘›ğ‘¦
ğ‘–=0
ğ‘ğ‘¦,ğ‘–                             (1) 
where Pi is the probability of i parent-peers leaving, which can be 
modeled by CTMC [3], and ğ‘ğ‘¦,ğ‘–  is the packet loss probability due to 
the leaving of i parent-peers. The calculation of ğ‘ğ‘¦,ğ‘–  is described 
below. 
When the number of leaving parent-peers exceeds ğ‘Ÿğ‘¦ + ğœğ‘¥ğ‘¦ 
(i.e.,ğ‘– > ğ‘Ÿğ‘¦ + ğœğ‘¥ğ‘¦), the lost packets cannot be recovered. Therefore, a 
packet is lost due to either of the three events: 1) the number of 
parent-peers leaving the system exceeds  ğ‘Ÿğ‘¦ + ğœğ‘¥ğ‘¦ , 2) the live 
parent-peers do not have the packet, and 3)  the packet is dropped 
during the transmission. These conditions are expressed by 
ğ‘ğ‘¦,ğ‘–>ğ‘Ÿğ‘¦+ğœğ‘¥ğ‘¦ =
ğ‘–
ğ‘›ğ‘¦
+ (
ğ‘›ğ‘¦ âˆ’ ğ‘–
ğ‘›ğ‘¦
âˆ™ ğ‘„ğ‘¦
ğ‘›) + (
ğ‘›ğ‘¦ âˆ’ ğ‘–
ğ‘›ğ‘¦
) âˆ™ (1 âˆ’ ğ‘„ğ‘¦
ğ‘›) âˆ™ ğ‘‘ğ‘¦ (2) 
where the three terms on the right-hand-side of (2) represent the 
occurrence probabilities of the three events, respectively. In (2), ğ‘„ğ‘¦
ğ‘› 
is the average packet loss probability of the parent-peers of peer y as 
calculated by 
ğ‘„ğ‘¦
ğ‘› =
1
ğ‘˜+ğ‘Ÿğ‘¦
âˆ‘ ğ‘„ğ‘ğ‘âˆˆparent(ğ‘¦) , (3) 
where parent(y) is the set of parent peers of peer y. ğ‘‘ğ‘¦  denotes the 
average channel packet drop rate between peer y and its parent-peers 
as follows:  
 6 
  
Fig. 2. Packet loss reduction for the succeeding-level child-peers of 
candidate peer y that has received ry redundant substreams and request 
one more. FEC(24,16) is applied, therefore the received ry ranges from 
0 to 7. 
Therefore, the gain on packet loss reduction to a succeeding 
child-peer is negligible if the depth of level is higher than one. 
Consequently, the energy function can be approximated well with only 
two terms:    
ğ»ğ‘™(?Ì…?|?Ì…?, ?Ì…?) â‰… ğ»0(?Ì…?|?Ì…?, ?Ì…?) + ğ»1(?Ì…?|?Ì…?, ?Ì…?) (15) 
The probability distribution of configuration Hamiltonian can be 
modeled by a Gibbs distribution [5]: 
ğ‘ƒ(?Ì…?|?Ì…?, ?Ì…?) =
1
ğ‘
exp,âˆ’ğ»ğ‘™(?Ì…?|?Ì…?, ?Ì…?)-  (16) 
where ğ‘ =  âˆ‘ exp,âˆ’ğ»ğ‘™(?Ì…?|?Ì…?, ?Ì…?)-?Ì…?  is the normalization factor. 
Based on (16), the set of random variables ?Ì…? forms a Gibbs random 
field (GRF). In addition, local energy is only related to the 
neighborhood that includes the candidate peers and its first-level 
child-peers. Therefore, the GRF can be represented as the Markov 
random field according to the Hammersley-Clifford theorem [5]. As a 
result, when a candidate peer obtains y one additional redundant 
substream, the gain of packet loss reduction only propagates to its 
first-level child-peers. With MRF, each parent-peer can construct the 
optimal configuration, i.e., maximizing the probability of the 
configuration or minimizing the local energy function in (17), in the 
mesh-based P2P network. 
?Ì…?âˆ— =  arg max
?Ì…?
ğ‘ƒ(?Ì…?) =  arg min
?Ì…?
ğ»ğ‘™(?Ì…?) (17) 
4. SIMULATION RESULTS 
We used P2Pstrsim [6] to evaluate the accuracy of the proposed 
packet loss estimation model and the performance of the proposed 
peer selection scheme. We used GT-ITM [8] to generate a topology 
with 2,500 peers as the configuration of simulations with P2Pstrsim. 
The end-to-end delay between a pair of peers is set to be uniformly 
distributed in the range of 10ms~500ms. The simulation time is set to 
30 minutes, where peers uniformly join the network within 30 minutes, 
and then leave the system independently after mean user viewing time 
Tv, that is assumed to be uniformly distributed in the range of Tv /2~Tv 
/2.  We set Tv = 30 minutes in our simulations to indicate that the 
viewing time of peers distributes in the range of 15~45 minutes 
uniformly. We also assume each user records the number of 
parent-peer departures in a time period and the average time to find a 
new replacement parent-peer so as to calculate parameter Ï for the 
CTMC model. We encoded a CIF (352x288) video at 30 fps with a 
bitrate of 300 kbps with the JM14.2 H.264 coder [9]. Each video 
bitstream is divided into 4 substreams and transmitted over 
mesh-based P2P networks. We use the average packet loss rate as the 
quality metric which indicates the number of lost packets in an 
ensemble over the number of requested substreams measured by the 
alive peers. 
We implemented four peer selection schemes and evaluated their 
packet loss performances: 1) Random peer selection (denoted as 
â€œRandomâ€): In this scheme, child-peers first randomly send substream 
request messages to the peers in the candidate parent-peers list who 
own the requested substreams.  The parent-peers then randomly 
accept substream requests until their available uplink bandwidth is 
exhausted [4]; 2) Incentive-based peer selection (denoted as 
â€œIncentiveâ€): Child-peers randomly send requests to their parent-peers. 
The child-peers who send the video substreams to their parent-peers 
are accepted by the parent-peers with higher priority [10]. 3) 
Throughput optimized peer selection (denoted as Throughput): Based 
on the available bandwidth information of their neighbors obtained 
through the gossiping messages, child-peers select their parent-peers 
to maximize their downlink throughput [11]; 4) The proposed 
contribution-guided peer selection (denoted as â€œProposedâ€). 
 8 
allocated that low-contribution child-peers can gain reasonable 
protection without sacrificing the protection capability of 
high-contribution peers. Hence the proposed method outperforms the 
Contribution method in terms of the overall packet loss performance 
of the system.  
 
5. CONCLUSION 
 
To address the packet loss problem over heterogeneous networks, we 
proposed a contribution-based peer selection mechanism for 
mesh-based P2P streaming systems. The proposed packet loss 
probability model considers the channel packet loss rate, peer 
departure, the FEC(n,k) code, and packet loss propagated from 
parent-peers. We have shown that the packet loss propagation in a 
mesh-based P2P network can be modeled with Markov random field. 
As a result, when parent-peers select their child-peers from the 
candidates, only the candidates and the succeeding first-level 
child-peers need to be taken into consideration without introducing 
severe performance degradation. This drastically reduces the 
complexity of packet protection in mesh-based structures. Our 
experimental results show that the proposed method effectively 
mitigates the packet loss probability in a mesh-based network. Since a 
tree-based P2P structure is a special case of a mesh-based structure, 
the proposed method can provide reliable streaming services in 
tree-based P2P systems as well. This research is published on ICME 
2011[12] and ICIP 2011[13]. 
 
5. REFERENCES 
 
[1] Y. Shan, I. V. BajiÄ‡, S. Kalyanaraman, and J. W. Woods, 
â€œOverlay multi-hop FEC scheme for video streaming,â€ Signal 
Process.: Image Commun. vol. 20, no. 8, pp. 710â€“727, 2005. 
[2] B. Akbari, H. R. Rabiee, M. Ghanbari, â€œPacket loss in 
peer-to-peer video streaming over the Internet. Multimedia 
Systems. pp. 345â€“361, 2008. 
[3] P.-J. Wu, J.-N. Hwang, C.-N. Lee, C.-C. Gau, and H.-H. Kap 
â€œEliminating packet loss accumulation in peer-to-peer streaming 
systems,â€ IEEE Trans. Circuits Syst. Video Technol., vol. 19, no. 
12, pp. 1766â€“1780,  Dec. 2009. 
[4] S. Xie, B. Li,  G. Y. Keung, and X. Zhang, â€œCoolstreaming 
design, theory, and practice,â€ IEEE Trans. Multimedia. vol. 9, no. 
8, pp. 1661-1671. Dec. 2007. 
[5] S. Z. Li, Markov Random Field Modeling in Computer Vision, 
Springer-Verlag. 
[6] P2Pstrsim [online]. Available: 
http://media.cs.tsinghua.edu.cn/~zhangm/ 
[7] ISO/IEC JTC1/SC29/WG11 and ITU-T SG16 Q.6, 2007. 
[8] E. W. Zegura, K. L. Calvert, and S. Bhattacharjee, â€œHow to 
model an internetwork,â€  Proc. IEEE INFOCOM, vol. 2., pp. 
594â€“602,  San Francisco, CA, Mar. 1996. 
[9] JM software [Online]. 
Available:http://iphome.hhi.de/suehring/tml/. 
[10] Z. Liu , Y. Shen,  K.W. Ross, S.S. Panwar, and Y. Wang, 
"LayerP2P: Using layered video chunks in P2P live streaming," 
IEEE Trans. Multimedia, vol. 11, no. 7, pp. 1340ï€­1352, Nov. 
2009. 
[11] M. Zhang, Y. Xiong, Q. Zhang, L. Sun, and S. Yang,  " 
Optimizing the throughput of data-driven peer-to-peer 
streaming," IEEE Trans. Parallel Distributed Syst., vol. 20, no. 1, 
pp. 97ï€­110, Jan. 2009. 
[12] C.-W. Lo, C.-W. Lin, Y.-C. Chen, and J.-Y. Yu, â€œA packet loss 
estimation model and its application to reliable peer-to-peer 
video streaming,â€ IEEE Workshop on Streaming and Media 
Communications (in conjunction with IEEE ICME), July 2011, 
Barcelona, Spain. 
[13] C.-W. Lo, C.-W. Lin, Y.-C. Chen, and J.-Y. Yu, 
â€œContribution-based peer selection for packet protection for P2P 
video streaming over mesh-based networks,â€ IEEE Int. Conf. 
Image Processing, Sept. 2011, Brussels, Belgium.
 
 
  
åœ‹ç§‘æœƒè£œåŠ©è¨ˆç•«è¡ç”Ÿç ”ç™¼æˆæœæ¨å»£è³‡æ–™è¡¨
æ—¥æœŸ:2011/10/13
åœ‹ç§‘æœƒè£œåŠ©è¨ˆç•«
è¨ˆç•«åç¨±: å­è¨ˆç•«äº”ï¼šç•°è³ªç„¡ç·šç¶²è·¯ä¸Šè·¨å±¤æ¬¡é»å°é»è¦–è¨Šå‚³è¼¸æœ€é©åŒ–æŠ€è¡“ç ”ç©¶(I)
è¨ˆç•«ä¸»æŒäºº: æ—å˜‰æ–‡
è¨ˆç•«ç·¨è™Ÿ: 99-2628-E-007-004- å­¸é–€é ˜åŸŸ: è¨Šè™Ÿè™•ç†
ç„¡ç ”ç™¼æˆæœæ¨å»£è³‡æ–™
å…¶ä»–æˆæœ 
(ç„¡æ³•ä»¥é‡åŒ–è¡¨é”ä¹‹æˆ
æœå¦‚è¾¦ç†å­¸è¡“æ´»å‹•ã€ç²
å¾—çé …ã€é‡è¦åœ‹éš›åˆ
ä½œã€ç ”ç©¶æˆæœåœ‹éš›å½±éŸ¿
åŠ›åŠå…¶ä»–å”åŠ©ç”¢æ¥­æŠ€
è¡“ç™¼å±•ä¹‹å…·é«”æ•ˆç›Šäº‹
é …ç­‰ï¼Œè«‹ä»¥æ–‡å­—æ•˜è¿°å¡«
åˆ—ã€‚) 
æ“”ä»» IEEE Transactions on Circuits and Systems for Video Technology åŠ
IEEE Transactions on Multimedia ç­‰åœ‹éš›é ‚å°–æœŸåˆŠä¹‹ Associate Editor 
 æˆæœé …ç›® é‡åŒ– åç¨±æˆ–å…§å®¹æ€§è³ªç°¡è¿° 
æ¸¬é©—å·¥å…·(å«è³ªæ€§èˆ‡é‡æ€§) 0  
èª²ç¨‹/æ¨¡çµ„ 0  
é›»è…¦åŠç¶²è·¯ç³»çµ±æˆ–å·¥å…· 0  
æ•™æ 0  
èˆ‰è¾¦ä¹‹æ´»å‹•/ç«¶è³½ 0  
ç ”è¨æœƒ/å·¥ä½œåŠ 0  
é›»å­å ±ã€ç¶²ç«™ 0  
ç§‘ 
æ•™ 
è™• 
è¨ˆ 
ç•« 
åŠ  
å¡« 
é … 
ç›® è¨ˆç•«æˆæœæ¨å»£ä¹‹åƒèˆ‡ï¼ˆé–±è½ï¼‰äººæ•¸ 0  
 
