 2 
 
 
z K { _ | }  
z K { _  z ~ '(  Â€ Â Â‚ Âƒ Â„ 

  Â… Â† /Â‡ Âˆ Â‰  
ÂŠ Â‹ ÂŒ 800   Â Â  
Â Â | } Â‘ Â’ Â“ Â” s `  Â• Â– `    
Â— Â˜  www.contrel.com.tw             Â™ Âš (02)86983554 
* + Â› Âœ (500 Â Â L ) 
   	 
                    ! "
TMS320C6711 DSP# Xilinx ! "  Spartan-II XC2S50 FPGA$% & ' ( )   * +,-
. / #0 1 2 3 I/O ,4 5 6 7 $8 2 9 : ; < => ? @ A < ,A   B $=C ) D
DSP E     F G * + IIOS/C âˆ’Âµ HI J K L ,  * +M N O PQ $R
S T F G * +
U V W 1 X: Y U V > Z N [  H F \] ,^ _ ` $: Y ; < a b
c d e f =g ] h ij k$l % m  n o L ,  p q $r    . / ,\] $
s t ) u v F ^ _ w x y p q E $z)    w x 	 
 
D   a     { |   }Cascade Control~K L  C ) $Â€ m  \Â Â‚
 ÂƒÂ„ Â… ,a $I Â† Â‡ Âˆ Â‰ ÂŠ Â‹ ÂŒ2 Â Â‚Â Â u ,Â Â H\Â‘Â‚Â’ Â“ Â‘Â”
  $D 2 Â‘Â‚Â• Â– Â‘Â”  j k$) Â— 
:  - Â’ Â“ Â˜ #Â™ Âš Â› Âœ Â— > 
u Â• Â
Â 0 1 $ÂŸ ? OSIIC âˆ’Âµ   F G * +$C )         $S T
w Â  Â  Â¡ $  * +Â¢Â£ c Â¤ Â¥ Â¦  c $zÂ§    ÂƒÂ’ #ÂƒÂ¨ Â“ ,	 Â© Âª
Â« Â¬ Â­ Â®       ${ |   $Â’ Â“ Â‘Â”  $  F G * +Âª
 
Abstract 
Industrial motion controller is usually developed in two phases: motion control design and 
real-time implementation.  For first phase, this project presents a digital servo driver that 
realizes a novel feedback controller based on position, velocity feedback using optical encoder 
information.  For second phase, this project develops an embedded motion controller based on 
TI TMS320C6711 DSP, XILINX Spartan-II XC2S50 FPGA and multitasking real-time kernel. 
In this project, the control scheme is implemented based on the TI TMS320C6711 DSP and 
 4 
n a ,   DSP based    $   K L R$Ã•#Ã³ 
 Â
 7    Â¥  
 ÂÂº $Â¥   XILINX Spartan-II XC2S50 FPGA   4
  C )  Â. / 
      TMS320C6711   u Â• ÂÂ 0 1 $9 * +
, c   $ z Â‘Â”t Ãu Â• ÂÂ 0 1 -  ! $"   XILINX Spartan-II 
XC2S50 FPGA # 0 1 $Â¥ Ã¬ $  % ^ & ' ( ÂŒ) , General I/O portXPWMÃ Encoder
i6 7  
 
   A < K L  
* +A <  F Â¼ * Rn +$, IIOS/C âˆ’Âµ 
    Â¼ #ÂƒÂ¹ Â½ Â¾ Â¼  Ã±
F  $:  - r CAD/CAM ; < . / 
Ã‚  Â¼  G-Code # M-Code S T Â¥  & ' (
  * +$u Â• ÂÂ 0 1 r ÂƒÂ¹ Â½ Â¾ 0 & ' ( 2 3 1 2 < E $     Â¼ ' (
3  F $ 4 r ÂƒÂ¹ Â½ Â¾ t 5 ) 6 7 Â½ Â¾ n Ãš  
U Â$  r  U Â & ' 8 6 9 - $Â¿
Ã€  % Â‚ : 6 9 Â½ Â¾ $j k ; Ã„ Ã… Â Â‚  - / < Â… = Â   ÂÂ $ . / ( Ã„ Ã…  zÂ—
> ? @    $r   ÂÂ ? @ $j k. / (Ã„ Ã…  z$I A   z$ ;  Â• Â–  $
r Â• Â– ÂÂ Â‘Â”(u Â• ÂÂ 0 1    $I C ) B Â‘Â‚  $RJ C ) v  
     Â‘Â‚ 
 6 
 
Z       
Â• Â–  [ \  
A u Â• C Â 0 1 (Digital Signal Processor, DSP) 
B 
% ]  ÃŒ ^ M _ ` 1 2 < ( Synchronous Dynamic RAM, 
SDRAM ) 
C Â² Â¼ ` 
a b  (Filed Programmable Gate Array , FPGA) 
D Â¥  (Printer Port) 
E Â˜ c 1 2 < (Flash) 
F JTAG  7 (IEEE-1149.1) 
G . / dÂ• e< Â… = Â (Pulse width modulationHPWM) 
ÂŠ * +    * +$f u Â• ÂÂ 0 1 g \3 1 2 h N 72K byte$i
j l 2 3  2 < 128M Byte % ]  ÃŒ ^ M _ ` 1 2 < ( Synchronous Dynamic RAM, 
SDRAM )$I Ã¯ k ÂƒÂ¹ Â½ Â¾ #6 9 Â½ Â¾ @  U l m _  
   Â¥ d :  Spartan-II XC2S50 Â² Â¼ ` 
 a b  (Filed Programmable Gate 
Array , FPGA)  Â® Xilinx ! " / Â¿,Â² Â¼ n o   $  Ã c $Â¦ N 1,728vn
o p e$384v CLB$n o qz 50,000q$Â²  I/O portz 176v$\3 RAM Â² z 24,576
Â• eÂ² Â¼ ` 
a b  $  0 1    Â• Â–  t Xu Â• ÂÂ I/O 0 1 X
PWM Â½ Â¾ t 5 iÂ— > C )  r u Â•   $ s t u Â• u v w (D/A)# v w u u Â• (A/D)
u x n y z  F  
   # PC {  Â& . :  Â¥  $r ÂƒÂ¹ Â½ Â¾ S T J  7 & ' (  
 8 
 
Â˜  zÂ— > ? @     
 
Â™ Â— > ? @  < \3 Âš Â‚ 
1.3               
o L    * +$Ãš >  Â¥ ) * +#w Â¦ Â§ Â¨ Â©   n Âª ) 
T U Ã‹ $d s
Â« > Â¬ Ã¢  Â­ 2 6 
Ã… Â®  B $I Ã Â¯ @ Ã® Ã»  % 
 Â… Â°   Â±  B Â² Â³ * + Â´ Âµ
 ÃŒ Ã c (Timing behavior)N Â« $   Â¶ N  J   Ã‘ - Â» 
Ã‘ - n o Â² ÂŠ J  
 * +  Â‰ M N  (Real time) Â³  (Multi-tasking)
Ã c $ÂŠ J   I I/ âˆ’OSCÂµ  
  F G Â¼ $K L RÂ·n + 
F G * +,F -  Jean J. Labrosse$Ã Q Â¸ Ã‹ [ > ÂƒXÂ¹  Âº Â… Â» X:  Â² Â¼
Â½ c . / XS T J F G * +: Y  )  Â¼ 
a Â³ j W Â Y ] h $  Ãš @ 
Z Â‡ Â¾ Â²
I Â¶ Ã‚ Ãµ 
Â— > $8 2 (=Â² %  W 1 64v F Hy  Â¼ 
a Â¿ Ã€ Â› $Ã Ã‚ Â² r
 10
 
Ã«    * +,K L  
D vC Ã¬ 
   * +Ã•$   Â€     * +,. / $   
Âº 7 5 Â (E Ã­ CAD/CAM,Â½ Â¾ $Â¥ r - k, ! ' (Â› Ã­
 zA  $ÂŠ J
   a 
Ã• Ã® $r 4 ÂŒ Ã¬ v   * + Âª ) Ã¯ @ 
Â Â Ã°Â² Y Ã± $
   . / Ã ÃŸ I Â› 3 % Â® 
(1) ÂƒÂ¹ Â½ Â¾ t 5  
(2)  Â‚: 6 9  
(3) Ã„ Ã…     
(4) u Â• ÂÂ 0 1 #2 3 A <  Â 
(5) Ã¢ Ã£ Ã² Â 
(6) Ã³ Q Ã´ Ãµ  
	
 
	 ï¬€ï¬ï¬‚ï¬ƒ	 
"!
#%$&
ï¬‚')(
*+,-
./
"0
ï¬‚
 
Ã°    . /  
 12

  
 
	 

    
 
% Â– Âš 6 9 +$  
3 $ %  ! " # &$ %  ! " # &$ %  ! " # &$ %  ! " # &  
v&  
B Â‚  * +Rdn +$
E Zvp en _ ) Â®  (Controller)X
Â < (Plant)#Ã¢ Ã£ (Sensor)    n Â› z
Â¯  Â½ Â¾ #Ã¢ Ã£ n Ã£ Y 
Â‘Â”C
Â w g $n Â¿Ã€ 
' (  ;   Â£ ) - / * ,
 Âµ C Â ' (Â < $ÂŠ J   * +

	 
$D y : * +
 . / >   n + , ,. / N j Â˜ Â’ #Â¨ Ã¹ 
 Â¥ )   ,
 	 
$D y     Â½ Â¾ #Â‘Â” C Â $Â¿Ã€ * ,
  Âµ C Â $: * +N j Â¤ 
 Â¥ ) $
 vT Â¼    C )   Â£ ) (Control Law)
Â¸ Ã‹   
 
d   * +
Âº -  
3r Ã„ Ã…  z* +$  Â• Â– Â’ Â“ Â‘Â”  $ÂŠ J 
E 2 3 Âˆ Â‰ ÃÂ¯ u Â  n Âª
) ,Â Â $.  Â’ Â“ Â Â‚Ã¼ e  #  & +Â’ Â“ Â• Â– Â Â‚  $Rdn +$ Â’ Â“ Â
Â‚IP   $% &   kvi#kvp$Â• Â– Â Â‚P   kpp 
 14
 ' (  F  
c ;  [ \  
 F (Task) 
  ` ÂƒÂ¹ Â½ Â¾ (Load command task) 
 ÂƒÂ¹ Â½ Â¾ t 5 (Parsing task) 
 Ã»Ã¼ 6 9 (Interpolator task) 
 Ã³ Q Ã´ Ãµ (Home) 
 Â 0 & . (ÂƒÂ¹ Ã³  (Send Messages 
to Host PC ) 
Â§ 1 1 2 < Ã’  U l  L  
(Ring Buffer) 
 m _ ÂƒÂ¹ Â½ Â¾ (G/M code queue) 
 ÂƒÂ¹ Â½ Â¾ t 5  6 9 n > <  Â½ Â¾
(Command data queue) 
 6 9 Â½ Â¾ (Interpolator queue) 
Ã•Â‡ V (Interrupt service 
routine) 
  ` PC { ÂƒÂ¹ Â½ Â¾ Â¼ (Printer port 
read ISR) 
 Ã„ Ã… Â Â‚Ã•Â‡ (Servo control ISR) 
D J } 5 = ÂƒÂ¹ Â½ Â¾ U l & . $:  A < Ã•Â‡ C ) ,$ÂŠ ,U l : & .  $
I >  A < Ã•Â‡ ÂÂ ? Ã±    $} U l & . (   $Â¥ d ,   5
= C U l Ã« & . / ÂÂ $I ? Ã± ÂƒÂ¹ Ã³ Â² r Â› @ U l A ÂŠ & . $I 7  U l B C ~
 Ã€  
Ã„ Ã…    I ' (  Â… Ã•Â‡ $Ã„ Ã…    c  B  ,Ãˆ Ã‰ ,Ã¾Ã¯ $D >
z)  Ã»Ã¼ Â’ Â“ #Â¨ Â“ $iÃ Ã‚ ' (  Â… Ã•Â‡ E C ) ,Â¥ d 4 Â°  Â« Ã¢ Ã£ $Ã« : 
 Â… Ã•Â‡ E w x $ÂŠ 4 Â°  Â« Ã² Ã£ Â« Â‚ Â‰ Â¨ Ã¹ $D  F Â£ 4 Â¢  Â… r Â« Ã² Ã£ 4 Â°  Â«
1  $D > Â´ Âµ 7  2 M Ã€  
G H Â® I ' (  F (Task)Ã­$ÂŠ  IIOS/C âˆ’Âµ    * +$,I v|I
vI E  F $ v F / N P0 J (Priority) F K Ã¤  $L Ã½ 
P0 J ) K ÂƒÂŠ J 
* +$' (  F P0 J M * Rn +Â² Y Ã±  ` ÂƒÂ¹ Â½ Â¾ (Load command task)P
0 J j Âƒ$s Â« 0 r CAD/CAMÂƒÂ¹ Â½ Ã”    $J     D >  Ã± u $i
Ã Ã‚ r P0 J Ã¯ Â§ j Âƒ$ÂŒ ÂƒÂ¹ Â½ Â¾ t 5 (Parsing task)$s Â« 0 r CAD/CAMÂƒÂ¹ Â½
Â¾ t 5 )  p Ã‹ ÂƒÂ¹ Â½ Â¾ $ Â½ Â¾ 6 9 (Interpolator task)#  3 Ã»Ã¼ 6 9 j k$
G I v F (Task)w   $Â0 & . (ÂƒÂ¹ Ã³ (Send Messages to Host PC )Ã¤  c N N  O
 16
Â¡ J       ,c > Â½ Â¾ p Â• u x 1mm=1000pulse 
G01 X50 Y50 F100; 
G01 X50 Y-50  F100; 
G01 X-50 Y-50  F100; 
G01 X-50 Y50  F100; 
G02 X50 Y50  I0 J50  F100; 
G02 X50 Y-50  I50 J0  F100; 
G02 X-50 Y-50  I0  J-50 F100; 
G02 X-50 Y50  I-50 J0  F100; 
 
dZ Â•   Â‘Â”Ã»Ã¼  
7. 9 :9 :9 :9 :  
) Â— 
:  - Â’ Â“ Â˜ #Â™ I/O Â— > 
u Â• ÂÂ 0 1 $ÂŸ ? OSIIC âˆ’Âµ 
  F G * +$C )         $S T w Â  Â  Â¡ $  * +Â¢
Â£ c Â¤ Â¥ Â¦  c $Â— zÂ§    ÂƒÂ’ #ÂƒÂ¨ Â“ ,	 Â©  
     M N j @ PQ $,N Z Ã• 
6 9 Ã‘ - Â» |Ãš  j l  $Â¶ O Z
Â‡ |Â¶ Ã‚ 6 9  F (Task)\] Â² |- $, N Z Ã• 
Ã„ Ã…   Ã‘ - Â» $Ã˜RE Z   X
Â„ > Ã•Â‡   (Multi-rate control)|M  ^ (Sliding mode)i  Â» I $Ã¬  % ~  Ãš  
% Ã„ Ã…   Â» I $Â¶ Ãš Z Â‡ Ã„ Ã… Ã•Â‡   Â¼ Â² $i* + Â— r Ã¬ vK L o L C Ã¬ $
W b c @ $Â² Ã¬  % Â— > #Ãš B $# * ,Z Â‡ $zÂ§ [ \ ` Ãš B  
 
