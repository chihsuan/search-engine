 2
ä¸€ã€ ç·£ç”±èˆ‡ç›®çš„ï¼š 
 
å…¨ï¥©ä½åŒ–å¹³å°é©…å‹•æ§åˆ¶å™¨ç³»çµ±ï¼Œå·²è”šç„¶
æˆç‚ºä¸€ç¨®é‹å‹•æ§åˆ¶å™¨ä¹‹ä¸»ï§Šï¼Œè€Œå¸¸ï¨Šæ–¼è‡ªå‹•
åŒ–æ©Ÿå…·ã€ï¥‰å°„ï¨€å‰²æ©Ÿã€é»è† æ©Ÿã€å€‰å„²è¨­å‚™ã€
åŠå°é«”å» è¨­å‚™ã€X-Y å¹³å°ã€ï¦²ä»¶æŠ“å–æ©Ÿã€é‹
è¼¸ç³»çµ±ã€è¡¨é¢è™•ï§¤å» ã€3D å·¥ä½œæ©Ÿâ€¦çš„å ´æ‰€
ä¸­ã€‚è¿‘ï¦ï¤­ï¼Œæ–‡ç»ä¸­æœ‰é—œæ–¼å¹³å°ä¹‹é©…å‹•æ§åˆ¶
æŠ€è¡“ä¹Ÿå¼•èµ·å»£æ³›ä¹‹ç ”ç©¶[1-13]ã€‚å¸¸ï¨Šçš„å¹³å°é©…
å‹•ç”±ä¸€é¡†é¦¬é”å¸¶å‹•æ»¾ç å°ï¤‘å°é‹è½‰ï¼Œä½¿å¾—è½‰
è½‰é‹å‹•è®Šæˆç›´ç·šé‹å‹•ï¼Œä»¥å¸¶å‹•å¹³å°ç§»å‹•ã€‚è€Œ
å¹³å°ä½ç½®æ§åˆ¶æ–¹æ³•ä¸­ï¼Œåˆåˆ†ç‚ºåŠé–‰è¿´ï¤·ä¼ºæœ
æ§åˆ¶å™¨ç³»çµ±åŠå…¨é–‰è¿´ï¤·ä¼ºæœæ§åˆ¶å™¨ç³»çµ±ï¥¸
ç¨®ï¼Œæ­¤ï¥¸ç¨®æ§åˆ¶å™¨æ¶æ§‹æè¿°å¦‚ä¸‹ï¼š 
(1) åŠé–‰è¿´ï¤·ä¼ºæœæ§åˆ¶å™¨ç³»çµ±ï¼š 
æ§åˆ¶å™¨æ¶æ§‹å¦‚åœ– 1(a)æ‰€ç¤ºï¼Œå…¶ä¸­å¹³å°ä¸Šæ²’
æœ‰ä½ç½®æ„Ÿæ¸¬å™¨ï¼Œåƒ…ï§ç”¨é¦¬é”å°¾ç«¯ä¹‹å…‰ç·¨ç¢¼å™¨
é–“æ¥è¨ˆç®—å¹³å°ä½ç½®ï¼Œä½œç‚ºä½ç½®è¿´æˆå€¼ä»¥é€²ï¨ˆ
é–‰è¿´ï¤·æ§åˆ¶ã€‚å› æ­¤ç¨±ç‚ºåŠé–‰è¿´ï¤·ä¼ºæœæ§åˆ¶ç³»
çµ±ã€‚ç„¶è€Œï¼Œè½‰å‹•é¦¬é”åŠå¹³å°é–“ä¹‹æ©Ÿæ¢°çµæ§‹ï¼Œ
ï¦µå¦‚ï¼šé½’ï§—ã€å°ï¤‘æ¡¿ç­‰ï¼Œé€™äº›çµæ§‹å¼•å…¥çš„ä¸€
äº›å•é¡Œï¼›è­¬å¦‚èƒŒéš™(backlash)é€ æˆçš„å®šä½ï¥§ï¨
ç¢ºã€æ‘©æ“¦ï¦Šçš„å¢åŠ ã€å°ï¤‘æ¡¿ä¹‹å°ç¨‹èª¤å·®ã€å› 
æ­¤å°‡é€ æˆèƒ½ï¥¾æå¤±ã€æ•…éšœï¥¡é«˜ã€æ§åˆ¶ï¥§ï§ ï¨
æº–ã€‚ 
(2) å…¨é–‰è¿´ï¤·ä¼ºæœæ§åˆ¶å™¨ç³»çµ±ï¼š 
æ§åˆ¶å™¨æ¶æ§‹å¦‚åœ– 1(b)æ‰€ç¤ºï¼Œå…¶ä¸­å¹³å°ä¸Šå…·
æœ‰ä½ç½®æ„Ÿæ¸¬å™¨ï¼Œå¯ç›´æ¥ï¥¾æ¸¬å¹³å°ä½ç½®ï¼Œä½œç‚º
ä½ç½®è¿´æˆå€¼ä»¥é€²ï¨ˆé–‰è¿´ï¤·æ§åˆ¶ã€‚å› æ­¤ç¨±ç‚ºå…¨
é–‰è¿´ï¤·ä¼ºæœæ§åˆ¶ç³»çµ±ã€‚æ­¤ç³»çµ±å°‡æ©Ÿæ¢°çµæ§‹é«”
ä¹‹éç·šæ€§å•é¡Œï¼Œå¦‚èƒŒéš™ã€æ‘©æ“¦ï¦ŠåŠå°ï¤‘æ¡¿ä¹‹
å°ç¨‹èª¤å·®ç­‰å«åœ¨å…§ï¼Œå› æ­¤æ§åˆ¶ä¸Šè¼ƒï¨æº–ï¼Œä½†
æ˜¯æ§åˆ¶çš„å›°é›£ï¨è¼ƒé«˜ã€‚ 
éš¨è‘—åŠå°é«”è£½é€ ä¹‹é€²æ­¥ï¼Œå„ç¨®æ€§èƒ½å„ªï¥¢ä¹‹
æ™¶ç‰‡ï¥§æ–·çš„è¢«é–‹ç™¼å®Œæˆï¼Œå¦‚ï¥©ä½è¨Šè™Ÿè™•ï§¤å™¨
(DSP)æ™¶ç‰‡ã€ç¾å ´å¯ç¨‹å¼ï¤“è¼¯é–˜é™£ï¦œ(FPGA)
æ™¶ç‰‡ã€å¾®æ§åˆ¶å™¨(Î¼C)æ™¶ç‰‡ç­‰ï¼Œè€Œé€™äº›æ™¶ç‰‡å¸¸å…·
æœ‰é«”ç©å°ã€åƒ¹æ ¼ä½ã€åŠŸèƒ½å¼·--å…·æœ‰é€šè¨Šã€ä¼ºæœã€
å³æ™‚è¨ˆç®—ã€è³‡ï¦¾å„²å­˜ã€å¯ç¨‹å¼ç­‰å„ªï¥¢æ€§èƒ½ï¼Œå¯
æä¾›å„ï¨ˆæ¥­ç™¼å±•åŠè¨­è¨ˆé©åˆè©²ï¨ˆæ¥­ä¹‹æ‡‰ç”¨è»Ÿ
ç¡¬é«”ï¼Œä»¥ææ˜‡å…¶ç”¢å“èˆ‡è¨­å‚™ä¹‹å“è³ªèˆ‡åŠŸèƒ½ï¼Œä½¿
ä¹‹é”åˆ°å°å‹åŒ–ã€ç¶²ï¤·åŒ–ã€ä½æˆæœ¬ã€ï¥­å…ƒä»¶ã€æ™º
æ…§å‹èˆ‡é«˜æ€§èƒ½çš„ç›®çš„ã€‚å°¤å…¶æ˜¯ Altera Stratix
æ™¶ç‰‡å…·æœ‰æœ€é«˜æ•ˆï¥¡ã€æœ€é«˜å¯†ï¨ã€å»£é—Šçš„è¨˜æ†¶é«”
è³‡æºåŠè±å¯Œç‰¹è‰²çš„å¹³å°ï¼Œæœ€é©åˆä½œç‚ºç ”ç™¼ç”¨ä¹‹
é©—è­‰æ™¶ç‰‡ã€‚Altera Stratix EP2S60ï¼Œå…±æœ‰ 48,352
å€‹ ALUTs å…ƒä»¶ï¼Œ æœ€å¤§æœ‰ 718 ä½¿ç”¨è€… I/O è…³
ä½ï¼Œ36 å€‹ DSP æ–¹å¡Šï¼Œå…±æœ‰ 2,544,192 bits çš„
è¨˜æ†¶é«”ï¼Œè€Œ Nios åµŒå…¥æ˜¯è™•ï§¤å™¨æœ‰ 16 ä½å…ƒæˆ–
æ˜¯ 32 ä½å…ƒå¯è¦åŠƒ CPU ç¨‹å¼ç¢¼ï¼Œ1~20Kbytes 
æ™¶ç‰‡å…§éƒ¨è¨˜æ†¶é«”èˆ‡ 4Gbytes æ™¶ç‰‡å¤–éƒ¨è¨˜æ†¶
é«”ï¼Œå¯ä»¥ä¸‹è¼‰åˆ° FPGA èˆ‡ IP é›»ï¤·ä¸€èµ·é‹ä½œï¤­
çµ„åˆå‡º SoPC ç’°å¢ƒ[14-17]ã€‚éœ€è¦è¨ˆç®—é€Ÿï¨å¿«ï¼Œ
å¯åœ¨ FPGA å…§ä»¥ç¡¬é«”å¯¦ç¾ï¼›éœ€è¦å½ˆæ€§è™•ï§¤ç¨‹
åºä½†é‹ç®—é€Ÿï¨ï¥§éœ€å¾ˆå¿«è€…ï¼Œå¯æ‡‰ç”¨ Nios II ä»¥
è»Ÿé«”å¯¦ç¾ã€‚è»Ÿç¡¬é«”åˆ†åˆ¥å¯¦ç¾ä½†æ˜¯å¹³ï¨ˆè™•ï§¤ï¼Œï¥§
åƒ…ï¥§æœƒæ¸›ä½ç³»çµ±æ€§èƒ½ï¼Œä¸”å¯æé«˜è¨­è¨ˆä¹‹ï¦³æ´»
æ€§ã€‚ 
å› æ­¤æœ¬è¨ˆç•«æœ¬ï¦ï¨å°‡å¼•å…¥ SoPC æŠ€è¡“ï¤­ç ”
è£½å–®è»¸å¹³å°å…¨é–‰è¿´ï¤·æ§åˆ¶ä¹‹ç³»çµ±æ•´åˆæ™¶ç‰‡ï¼Œå¦‚
åœ– 2 æ‰€ç¤ºã€‚æ­¤ç³»çµ±æ•´åˆæ™¶ç‰‡å…§ä¸»è¦åŒ…æ‹¬ï¥¸å€‹æ¨¡
çµ„ï¼Œç¬¬ä¸€å€‹æ¨¡çµ„åœ¨ Nios è™•ï§¤å™¨å…§ä»¥è»Ÿé«”ç¨‹å¼
å¯¦ç¾ï¼Œå…¶åŠŸèƒ½åŒ…å«é»å°é»é‹å‹•è»Œè·¡ä¹‹è¨ˆç®—ï¼›ç¬¬
äºŒå€‹æ¨¡çµ„åœ¨ FPGA æ™¶ç‰‡å…§ä»¥ï¥©ä½ç¡¬é«”æ–¹å¼å¯¦
ç¾ï¼Œå…¶åŠŸèƒ½ä¸»è¦ç‚ºå…¨é–‰è¿´ï¤·å¹³å°ä½ç½®æ§åˆ¶ã€‚ 
 
äºŒã€ ç ”ç©¶æ–¹æ³•ï¼š 
 
æ­¤è¨ˆç•«ä»Šï¦ï¨è‘—é‡ã€å–®è»¸å¹³å°å…¨é–‰è¿´ï¤·
æ§åˆ¶æ™¶ç‰‡ä¹‹è¨­è¨ˆã€ï¼Œä¸¦ä»¥æœ‰é™ï§ºæ…‹æ©Ÿæ³•è¨­è¨ˆæ¨¡
ç³Šæ§åˆ¶å™¨åŠä»¥ VHDL èªè¨€æè¿°ã€‚åœ– 2 ç‚ºä»¥
FPGA ç‚ºåŸºç¤å»ºæ§‹çš„å–®è»¸å¹³å°ä¼ºæœæ§åˆ¶å™¨ç³»
çµ±æ¶æ§‹ã€‚åœ–ä¸­ Nios åµŒå…¥å¼è™•ï§¤å™¨åŸ·ï¨ˆé‹å‹•è»Œ
è·¡è¨ˆç®—ï¼Œè€Œå–®è»¸å¹³å°ä¹‹é›»ï§Šè¿´ï¤·ã€é€Ÿï¨è¿´ï¤·
åŠä½ç½®è¿´ï¤·ä¹‹æ§åˆ¶å™¨å…¨éƒ¨åœ¨ FPGA ä»¥ç¡¬é«”å¯¦
ç¾ã€‚è©³ç´°ä¹‹è¨­è¨ˆæ–¹æ³•ï¥¯æ˜å¦‚ä¸‹ï¼š 
2.1 å–®è»¸å¹³å°(å«æ°¸ç£åŒæ­¥é¦¬é”)çš„ï¥©å­¸æ¨¡å¼ 
é¦–å…ˆï¥¯æ˜æ°¸ç£åŒæ­¥é¦¬é”çš„ä¼ºæœç³»çµ±æ§åˆ¶
æ–¹å¡Šåœ–å¦‚åœ– 2 æ‰€ç¤ºï¼Œé¦¬é”çš„å‹•æ…‹æ–¹ç¨‹å¼å¦‚ä¸‹ï¼š  
d
d
q
d
q
ed
d
sd v
L
i
L
L
i
L
R
dt
di 1ï€«ï€«ï€­ï€½ ï·  (1) 
q
qq
f
eq
q
s
d
q
d
e
q v
L
1
L 
 
i
L
Ri
L
L
dt
di ï€«ï€­ï€­ï€­ï€½ ï¬ï·ï·  (2) 
å…¶ä¸­ vd, vq æ˜¯ d è»¸èˆ‡ q è»¸çš„é›»å£“ ; id, iq, 
æ˜¯ d è»¸èˆ‡ q è»¸çš„é›»ï§Š, Rs æ˜¯ç›¸ç¹çµ„é›»é˜»; 
Ld, Lq æ˜¯ d è»¸èˆ‡ q è»¸çš„é›»æ„Ÿ; pxï€¦  ç‚º è½‰å­
é€Ÿï¨; fï¬ æ˜¯æ°¸ä¹…ç£éµçš„ä¿‚ï¥©. PMSM çš„é›»ï§Š
æ§åˆ¶æ˜¯ä»¥å‘ï¥¾æ§åˆ¶ï¤­å¯¦ç¾ã€‚å› æ­¤å‡å¦‚æ§åˆ¶ id 
ç‚º 0ï¼Œå‰‡ PMSM å°‡æœƒè§£è€¦åˆï¼Œå› æ­¤åœ¨æ§åˆ¶
PMSM å°‡æœƒè®Šå¾—å¦‚åŒæ§åˆ¶ç›´ï§Šé¦¬é”èˆ¬çš„å®¹
 4
ç”¨ 24 æ­¥é©Ÿï¤­åŸ·ï¨ˆæ•´é«”é›»ï¤·è¨ˆç®—ã€‚åœ– 5(a)ä¸­è³‡
ï¦¾å‹æ…‹ç‚º Q11 ä¹‹ 12 ä½å…ƒä¸”å…· 2 çš„è£œï¥©ä¹‹é‹
ç®—ã€‚æ­¤é›»ï¤·ä¸­ï¼Œæ­¥é©Ÿ s0~s1 ç‚º sin/cos æŸ¥è¡¨ï¼›
æ­¥é©Ÿ s2~s5åŠ s5~s8 ç‚º Clarkã€ Park åº§æ¨™è½‰æ›
è¨ˆç®—ï¼›æ­¥é©Ÿ s9~s14 ç‚º d-è»¸åŠ q-è»¸ PI æ§åˆ¶å™¨ä¹‹
è¨ˆç®—ï¼›æ­¥é©Ÿ s15~s19 åŠ s20~s23 å„è‡ªç‚ºåå‘ Parkã€
åå‘ Clarke ä¹‹åº§æ¨™è½‰æ›è¨ˆç®—ã€‚åœ¨ FPGA å…§æ¯
ä¸€å€‹è¨ˆç®—æ­¥é©Ÿç‚º 40ns(25MHz æ™‚è„ˆ)ï¼›å› æ­¤ 24
å€‹æ­¥é©Ÿéœ€è¦ 0.96 ï­s çš„æ“ä½œæ™‚é–“ã€‚è‡³æ–¼å¾Œè€…ä½
ç½®è¿´ï¤·æ¨¡ç³Šæ§åˆ¶å™¨åŠé€Ÿï¨è¿´ï¤· P æ§åˆ¶å™¨é›»ï¤·
ä¹Ÿæ˜¯æ¡æœ‰é™ï§ºæ…‹æ©Ÿ(FSM)æ³•è¨­è¨ˆï¼Œå¦‚åœ– 5(b)
æ‰€ç¤ºã€‚æ­¤é›»ï¤·ä½¿ç”¨ä¸€å€‹åŠ æ³•å™¨ã€ä¸€å€‹ä¹˜æ³•å™¨ã€
ï¥©å€‹æ¯”è¼ƒå™¨åŠæš«å­˜å™¨ã€å¯æŸ¥è¡¨æ ¼è€Œçµ„æˆï¼Œä¸¦
é‹ç”¨ 23 æ­¥é©Ÿï¤­åŸ·ï¨ˆæ•´é«”é›»ï¤·è¨ˆç®—ã€‚é›–ç„¶æ¨¡ç³Š
æ§åˆ¶å™¨ä¹‹è¨ˆç®—ç›¸ç•¶è¤‡é›œï¼ŒFSM æ³•ä¹Ÿå¯å¾ˆé©ç•¶
ä»¥ VHDL èªæ³•ï¤­æè¿°æ­¤é›»ï¤·ã€‚æ­¤é›»ï¤·ä¸­ï¼Œæ­¥
é©Ÿ s0~s2 ç‚ºé€Ÿï¨ã€ä½ç½®èª¤å·®ã€åŠä½ç½®èª¤å·®è®ŠåŒ–
å€¼ä¹‹è¨ˆç®—ï¼›æ­¥é©Ÿ s3~s6ç‚ºæ¨¡ç³ŠåŒ–è¨ˆç®—ï¼›s7 æè¿°
æŸ¥è¡¨åŠŸèƒ½ï¼›s8~s16 ç‚ºè§£æ¨¡ç³ŠåŒ–ï¼›s17~s22 åŸ·ï¨ˆé€Ÿ
ï¨åŠé›»ï§Šå‘½ï¦¨è¼¸å‡ºä¹‹è¨ˆç®—ã€‚åœ¨ FPGA å…§æ¯ä¸€
å€‹è¨ˆç®—æ­¥é©Ÿç‚º 40ns (25MHz æ™‚è„ˆ)ï¼›å› æ­¤åŸ·ï¨ˆ
23 å€‹æ­¥é©Ÿéœ€è¦ 0.92 ï­s çš„æ“ä½œæ™‚é–“ã€‚ æ­¤æ™‚é–“
å› ç‚ºæ¯” 500 ï­s (2 kHz)å°ï¼Œæ‰€ä»¥ï¥§æœƒå½±éŸ¿ç³»çµ±
æ§åˆ¶æ€§èƒ½ã€‚åœ– 4(a)ä¸­å–®è»¸å¹³å°é‹å‹•æ§åˆ¶æ™¶ç‰‡
ä¹‹ FPGA è³‡æºä½¿ç”¨è¡¨å¦‚åœ– 4(b)æ‰€ç¤ºï¼Œç¸½å…±ä½¿
ç”¨ 10,157 ALUTs åŠ 129,792 bits RAMï¼Œå…¶ä¸­
NiosII è™•ï§¤å™¨ä½¿ç”¨ 5,059 ALUTs åŠ 78,592 bits 
RAM è€Œä½ç½®æ§åˆ¶ IP ä½¿ç”¨ 5,098 ALUTs åŠ
51,200 bits RAMã€‚ 
 
2.5 å¯¦é©—ç³»çµ±èˆ‡å¯¦é©—çµæœï¼š 
 
(1) å¯¦é©—ç³»çµ±:  
XYZå¹³å°æ§åˆ¶ç³»çµ±åŠä»¥ FPGAç‚ºåŸºç¤å–®
è»¸å¹³å°ä¼ºæœæ§åˆ¶å™¨ä¹‹æ¶æ§‹åœ–å¦‚åœ– 6 æ‰€ç¤ºã€‚æ­¤
ç³»çµ±åŒ…æ‹¬ä¸€çµ„ FPGA å¯¦é©—æ¿ï¼Œä¸‰çµ„å…·æœ‰ï§‘é¡†
IGBT ä¹‹é›»å£“æºå¼æ›ï§Šå™¨åŠä¸€çµ„å…·æœ‰ 30cm   
x30cmx15cm å·¥ä½œï¨ˆç¨‹ä¹‹ XYZ å¹³å°ã€‚æ­¤å¹³å°
æ¯ä¸€è»¸ç”±ä¸€é¡† PMSM é©…å‹•æ»¾ç ï¤‘æ¡¿é‹è½‰ã€‚
PMSM ä¹‹é¡å®šåŠŸï¥¡ã€é›»å£“ã€é›»ï§ŠåŠè½‰é€Ÿç‚º
200Wã€92Vã€1.6A åŠ 3000rpmã€‚é¦¬é”å°¾ç«¯é™„
æœ‰ä¸€é¡†å…‰ç·¨ç¢¼å™¨ï¼Œå…¶è§£æï¨ç‚º 2500pprã€‚å¹³
å°å…§æ»¾ç å°ï¤‘æ¡¿ï¼Œæ¯æ—‹è½‰ä¸€åœˆå¹³å°å°‡ä½ç§»
0.5cmã€‚X è»¸åŠ Y è»¸å¹³å°ä¸Šé™„æœ‰ä¸€æ¢ç·šå‹å…‰å­¸
å°ºï¼Œå…¶è§£æï¨ç‚º 5ï­mã€‚åœ– 6(b)ä¸­ï¼Œæ›ï§Šå™¨æœ‰
ï§‘å€‹ IGBT å‹å¼ä¹‹åŠŸï¥¡æ™¶é«”ã€‚IGBT é›»æ™¶é«”
é›†å°„æ¥µä¹‹é¡å®šé›»å£“ç‚º 600Vï¼Œé–˜å°„æ¥µé¡å®šé›»
å£“ç‚ºï‚±20Vï¼Œé›†æ¥µ DC é¡å®šé›»ï§Šç‚º 25Aï¼ŒçŸ­æ™‚
é–“(1ms) é¡å®šé›»ï§Šç‚º 50Aã€‚å…‰è€¦åˆéš”ï§ª IC å‹
è™Ÿç‚º TLP250ï¼Œå…¶è¼¸å‡ºå…·æœ‰æ¨æŒ½æ”¾å¤§å™¨åŠŸèƒ½ï¼Œ
ç›¸ç•¶é©åˆä½œç‚º IGBTæˆ–MOSFETæ™¶é«”é–˜æ¥µä¹‹
é©…å‹•é›»ï¤·ã€‚æ›ï§Šå™¨èˆ‡é©…å‹•é›»ï¤·ä¹‹è¼¸å…¥ä¿¡è™Ÿç‚º
FPGA æ™¶ç‰‡è¼¸å‡ºä¹‹ä¸‰çµ„ PWM ä¿¡è™Ÿã€‚FPGA
å…ƒä»¶æ¡ç”¨ Altera Stratix EP2S60ï¼Œå…±æœ‰ 48,352
å€‹ ALUTs å…ƒä»¶ï¼Œ æœ€å¤§æœ‰ 718 ä½¿ç”¨è€… I/O è…³
ä½ï¼Œ36 å€‹ DSP æ–¹å¡Šï¼Œå…±æœ‰ 2,544,192 bits
çš„è¨˜æ†¶é«”ï¼Œè€Œ Nios åµŒå…¥æ˜¯è™•ï§¤å™¨æœ‰ 16 ä½
å…ƒæˆ–æ˜¯ 32 ä½å…ƒå¯è¦åŠƒ CPU ç¨‹å¼ç¢¼ï¼Œ
1~20Kbytes æ™¶ç‰‡å…§éƒ¨è¨˜æ†¶é«”èˆ‡ 4Gbytes æ™¶ç‰‡
å¤–éƒ¨è¨˜æ†¶é«”ï¼Œå¯ä»¥ä¸‹è¼‰åˆ° FPGA èˆ‡ä½¿ç”¨è€…è¨­
è¨ˆä¹‹ IP é›»ï¤·ä¸€èµ·é‹ä½œï¤­çµ„åˆå‡º SoPC ç’°å¢ƒã€‚ 
(2) å¯¦é©—çµæœï¼š 
ç‚ºé©—è­‰æ‰€æ FPGA-based å–®è»¸å¹³å°é‹å‹•æ§
åˆ¶æ™¶ç‰‡ä¹‹æ­£ç¢ºæ€§ï¼Œæœ¬è¨ˆç•«é€²ï¨ˆå¹³å°åŠé–‰è¿´ï¤·
åŠå…¨é–‰è¿´ï¤·ä½ç½®æ§åˆ¶ï¨ï¨æ¯”è¼ƒã€æ–¹æ³¢æ­¥ç´šéŸ¿
æ‡‰åŠé»å°é»è»Œè·¡è¿½è¹¤éŸ¿æ‡‰æ€§èƒ½ä¹‹å¯¦é©—ã€‚é¦–å…ˆ
ç‚ºå¹³å°åŠé–‰è¿´ï¤·åŠå…¨é–‰è¿´ï¤·ä½ç½®æ§åˆ¶ï¨ï¨æ¯”
è¼ƒã€‚å–®è»¸å¹³å°ä½ç§»ï¨ˆç¨‹è¨­è¨ˆç‚º 35mmï¼Œä¸¦ä»¥
å…‰å­¸ç·šæ€§å°ºç•¶ä½ç½®å›æˆå€¼çš„å…¨é–‰è¿´ï¤·æ§åˆ¶åŠ
ä»¥é¦¬é”å°¾ç«¯ä¹‹å…‰ç·¨ç¢¼å™¨é–“æ¥è¨ˆç®—å¹³å°ä½ç½®ï¼Œ
ä½œç‚ºä½ç½®è¿´æˆå€¼ä¹‹åŠé–‰è¿´ï¤·æ§åˆ¶ï¼Œï¤­é€²ï¨ˆå¯¦
é©—ã€‚å¯¦é©—çµæœå¦‚åœ– 7 æ‰€ç¤ºï¼Œå…¶ä¸­å–å‡ºå‰å¾Œï¥¸
æ®µåœ–å½¢(åœ– 7(b)~åœ– 7(d))å‡ºï¤­è§€å¯Ÿï¼Œå¯ä»¥ç™¼ç¾
åŠé–‰è¿´ï¤·æ§åˆ¶çš„èª¤å·®è¶Šï¤­è¶Šå¤§ï¼Œä¸”ç”±åœ– 7(c)
é¡¯ç¤ºï¼Œï¨ˆç¨‹ 35mm æ™‚ï¥ç©èª¤å·®ç´„ 0.026mmã€‚
å› æ­¤ï¥´æ•´å€‹ X è»¸å¹³å° 300mm çš„å·¥ä½œï¨ˆç¨‹å°‡
ç”¢ç”Ÿç´„ 0.223mm çš„ä½ç½®ï¥ç©èª¤å·®ï¼Œç›¸ç•¶å¯
è§€ã€‚æ­¤çµæœä¹Ÿè­‰å¯¦å…¨é–‰è¿´ï¤·ä½ç½®æ§åˆ¶é›–ç„¶æ§
åˆ¶æŠ€è¡“è¼ƒè¤‡é›œï¼Œä½†æ˜¯å¯ç²å¾—è¼ƒé«˜çš„å®šä½ï¨
ï¨ã€‚æ¥è‘—ä»¥ä½ç½®æ­¥ç´šéŸ¿æ‡‰ï¤­è©•ä¼°æ‰€ææ§åˆ¶ç³»
çµ±æ§åˆ¶æ€§èƒ½ã€‚åœ¨ä½ç½®æ­¥ç´šéŸ¿æ‡‰å¯¦é©—ä¸­ï¼ŒX-è»¸
å¹³å°ä¹‹ä¹‹ä½ç½®å‘½ï¦¨ç‚ºå¤§å° 10 mm åŠé€±æœŸ
0.5Hz ä¹‹æ–¹æ³¢è¨Šè™Ÿï¼›è€Œå…¶éŸ¿æ‡‰çµæœå¦‚åœ– 8 æ‰€
ç¤ºã€‚å…¶ä¸Šå‡æ™‚é–“ã€è¶…è¶Šï¥¾åŠç©©å®šå€¼å„è‡ªç‚º
110msã€14%åŠå¹¾ä¹ 0mmã€‚åœ¨é»å°é»é‹å‹•è»Œ
è·¡æ§åˆ¶å¯¦é©—ä¸­ï¼Œæ¡ç”¨æ¢¯å½¢é€Ÿï¨é‹å‹•è»Œè·¡ä¸”å…¶
åŠ æ¸›é€Ÿå€¼ç‚º 500mm/s2ã€æœ€å¤§é€Ÿï¨ç‚º 125mm/s
åŠç§»å‹•ç¸½ï¨ˆç¨‹å¾ 0 mm åˆ° 100 mmï¼›å…¶è»Œè·¡
è¿½è¹¤éŸ¿æ‡‰çµæœå¦‚åœ– 9 æ‰€ç¤ºã€‚æ­¤çµæœé¡¯ç¤ºï¥§ç®¡
åœ¨ä½ç½®æˆ–é€Ÿï¨æ–¹é¢ï¼Œå¹³å°é‹å‹•ï¨¦èƒ½è¿½è¹¤åˆ°å‘½
ï¦¨è»Œè·¡ã€‚å› æ­¤ç”±åœ– 7~åœ– 9 çš„å¯¦é©—çµæœå¯ä»¥é©—
è­‰ï¼Œæ‰€æ FPGA å–®è»¸å¹³å°é‹å‹•æ§åˆ¶æ™¶ç‰‡çš„æœ‰
 6
FPGA Technologyâ€, IEEE Trans. on Industrial 
Electronics. Vol. 56, No. 1, Jan. 2009, pp. 43-53. 
(SCI) 
[20] R.F. Fung, M.H. Weng and Y.S. Kung, 
â€œFPGA-Based Adaptive Backstepping Fuzzy Control 
for a Micro-positioning Scott-Russell Mechanism,â€ 
Mechanical Systems and Signal Processing, Vol. 23, 
No.8, Nov. 2009, pp. 2671â€“2686. (SCI) 
[21] Y.S. Kung and M.H. Tsai, â€œSoPC-based Position 
Control IC for PMLSM Driveâ€, International Journal 
of Electrical Engineering (IJEE), Vol.15, No.5, Oct. 
2008. (EI) 
[22] è”¡æ˜å®ã€é™³ï¥¼æ¦®ã€é¾”æ‡‰æ™‚, â€œä»¥ FPGA ç‚ºåŸºç¤ç·šå‹
X-Y å¹³å°æ§åˆ¶æ™¶ç‰‡ç ”è£½,â€ é›»ï¦Šé›»å­æœˆåˆŠ, vol.7, 
no.1, pp.41~50, 2009. 
[23] é¾”æ‡‰æ™‚, â€œä»¥ TMS320F2812 DSP ç‚ºåŸºç¤ç„¡ä½ç½®æ„Ÿ
æ¸¬å™¨é›»å‹•è·‘æ­¥æ©Ÿé€Ÿï¨æ§åˆ¶å™¨ä¹‹ç ”è£½,â€å·¥ç¨‹ç§‘æŠ€é€š
è¨ŠæœŸåˆŠ, 2009 ï¦ 8 æœˆ. 
[24] Y.S. Kung, Nguyen Khanh Quang and Le Thi Van 
Anh, â€œFPGA-based Neural Fuzzy Controller Design 
for PMLSM Drive,â€ Accepted by the 8th 
International Conference on Power Electronics and 
Drive Systems (PEDS'09), Nov. 2~5, 2009, Taipei, 
Taiwan. (EI) 
[25] Y.S. Kung, M.S. Wang and T.Y. Chuang, 
â€œFPGA-Based Self-Tuning PID Controller using 
RBF Neural Network and its Application in X-Y 
Table,â€ 2009 IEEE International Symposium of 
Industrial Electronics (IEEE ISIE 2009), pp. 
694~699, July 5~8, 2009, Seoul, Korea. 
[26] Y.S. Kung, T.W. Tsui and N.H. Shieh, â€œDesign 
and Implementation of a Motion Controller for XYZ 
Table based on Multiprocessor SoPC,â€ 2009 
Chinese Control and Decision Conference (2009 
CCDC), pp. 274~252, June 17-19, 2009, Guilin, 
China. (EI) 
[27] Y.S. Kung, M.S. Wang and C.C. Huang, 
â€œDSP-based Adaptive Fuzzy Control for a 
Sensorless PMSM Drive,â€ 2009 Chinese Control 
and Decision Conference (2009 CCDC), pp. 
2390~2395, June 17-19, 2009, Guilin, China. (EI) 
[28] é¾”æ‡‰æ™‚, â€œé¦¬é”é›»ï§Šè½‰é€Ÿé›»ï§Šæ§åˆ¶æ¨¡çµ„â€ï¼Œå·¥ç ”é™¢
èƒ½ç’°æ‰€ç”¢å­¸åˆä½œè¨ˆç•«ï¼Œ98ï¦4æœˆ~ 98ï¦10æœˆã€‚ 
 
Motion Table 
rï·SVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di
ï€«
ï€­
ï€­
ï¡v
ï¢v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di
ï€«
Encoder
detector & 
Transform.
-
Rectifier
ï€« ï€­
AC
A/D
bi
1ï€­
Modified 
Clarke1ï€­Park
Park Clarke
A
B
ï¢ï¡,
ï¢ï¡,
cba ,,
cba ,,
ï¢ï¡,
qd,
ï¢ï¡,
qd,
Sin&Cos
= 0
LPF
A/D LPF
Î±i
Î²i
Full digital implementation
eï± Comparator
Circuit
To x-axis or 
y-axis PMSM
Signal from 
Rotary Encoder
+
-
1-z-1
vK
u
Intelligent
controller
*
px Reference 
Model
+
_
e
Position loop using Intelligent Controller
and Speed loop using PI controller
px
mx
pxTrajectory
Planning
Position 
command
Current loop 
using vector control
PMSM
px
 
(a) 
rï·SVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di
ï€«
ï€­
ï€­
ï¡v
ï¢v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di
ï€«
Encoder
detector & 
Transform.
-
Rectifier
ï€« ï€­
AC
A/D
bi
1ï€­
Modified 
Clarke1ï€­Park
Park Clarke
A
B
ï¢ï¡,
ï¢ï¡,
cba ,,
cba ,,
ï¢ï¡,
qd,
ï¢ï¡,
qd,
Sin&Cos
= 0
LPF
A/D LPF
Î±i
Î²i
Full digital implementation
px
eï± Comparator
Circuit
Z
-A
B
Comparator
Circuit
To x-axis or 
y-axis PMSM
Signal from 
Rotary Encoder
Signal from
Linear Encoder
Encoder
detector & 
Transform.
Motion Table 
Linear 
encoder 
+
-
1-z-1
vK
u
Intelligent
controller
*
px Reference 
Model
+
_
e
Position loop using Intelligent Controller
and Speed loop using PI controller
px
mx
pxTrajectory
Planning
Position 
command
Current loop 
using vector control
PMSM
 
(b) 
åœ– 1. å–®è»¸å¹³å°(a)åŠé–‰è¿´ï¤·åŠ(b)å…¨é–‰è¿´ï¤·ä¼ºæœæ§åˆ¶å™¨ç³»çµ±æ¶æ§‹åœ– 
Nios Processor II
Altera FPGA 
XYZ Table
Comparator 
circuit
B,B
A,A
A, B
LP filter 
circuit
bi
L
C
Rectifier Inverter
ac source
Isolated and driving circuits
ï€«
AT
ï€­
AT
ï€«
BT
ï€­
BT
ï€«
CT
ï€­
CT
U,V,W
ADC
ADC
ai
PWM6PWM1
zz,z
Comparator 
circuit
B,B
A,A
A, B
zz,z
PMSM
Linear encoder
Digital circuit (PLD)
of servo controller
for single-table
External
memory
Rotary encoder
Motor power
PC
 
åœ– 2. FPGA-based å–®è»¸å¹³å°ä¼ºæœæ§åˆ¶å™¨ç³»çµ±æ¶æ§‹åœ– 
 8
FPGA 
controller
X-table
Y-table
Drivers of 
PMSM
Z-table
  
(6) IGBT
UP VP WP UN VN WN
ï¤“è¼¯ä¿è­·é›»ï¤·
å…‰è€¦åˆ
FPGA motion controller
PWM1  ~  PWM6
U
V
W
PMSM
Current 
sensor
ä½é€šï¦„æ³¢å™¨
AD1 AD2
æ¯”è¼ƒé›»ï¤·
Rotary 
Encoder
QEP1~QEP3   QEP4~QEP6
L
C
æ•´ï§Šå™¨
äº¤ï§Š
ï¤­æº
P
N
ä½é€šï¦„æ³¢å™¨
Motion Table 
Linear 
Encoder
ADC574 ADC574
 
(a)                                           (b) 
åœ– 6. XYZ å¹³å°(a)å¯¦é«”åœ–åŠ(b)FPGA-based å–®è»¸æ§åˆ¶å™¨æ–¹å¡Šåœ– 
0 1 1.5 2 2.5 3.5
0
30
35
A
Measured by linear encoder
Measured by rotary encoder 
0.5 3
5
10
15
20
25
Time (s)
Po
si
tio
n 
(m
m
)
1.02 1.03 1.04 1.05 1.06 1.07 1.08 1.091.01 1.11.0
10
11
B
(a)
Measured by linear encoder
Measured by rotary encoder 10.2
10.4
10.6
10.8
Time (s)(b)
Po
si
tio
n 
(m
m
)
0 1 1.5 2 2.5 3.50.5 3
Time (s)(c)
Er
ro
r (
m
m
)
3.42 3.43 3.44 3.45 3.46 3.47 3.48 3.493.41 3.53.4
Time (s)(d)
Measured by linear encoder
Measured by rotary encoder 
Po
si
tio
n 
(m
m
)
A
B
34
35
34.2
34.4
34.6
34.8
0.03
0.005
0
0.015
0.025
0.01
0.02
 
åœ– 7. å¹³å°åŠé–‰è¿´ï¤·åŠå…¨é–‰è¿´ï¤·ä½ç½®æ§åˆ¶ï¨ï¨æ€§èƒ½æ¯”è¼ƒ 
0 1 2 3 4 5 6 7 8 9 10
-5
0
5
10
15
Time (s)
P
o
si
ti
o
n
 (
m
m
) X-axis table (using FC)Position response Position command
Output of 
reference model
(a)
0 1 2 3 4 5 6 7 8 9 10
-2
0
2
Time (s)
C
u
rr
en
t 
(A
)
(b)    
åœ– 8. X è»¸å¹³å°æ­¥ç´šéŸ¿æ‡‰ 
0 2 4 6 8 10 12 14
-50
0
50
100
150
Time (s)
P
o
si
ti
o
n
 (
m
m
)
0 2 4 6 8 10 12 14
-200
0
200
Time (s)
S
p
ee
d
 (
m
m
/s
)
Mover position
X-axis table
Speed command
Mover tracking speed
(b)
Position command
(a)
X-axis table
 
åœ– 9. é»å°é»é‹å‹•è»Œè·¡æ€§èƒ½(a)ä½ç½®è»Œè·¡è¿½è¹¤(b)é€Ÿï¨è»Œè·¡è¿½è¹¤ 
 1
å‡ºå¸­åœ‹éš›å­¸è¡“æœƒè­°å¿ƒå¾—å ±å‘Š 
                                                             
è¨ˆç•«ç·¨è™Ÿ NSC 97-2221-E-218 -055  
è¨ˆç•«åç¨± ä»¥ FPGA ç‚ºåŸºç¤ä¸‰è»¸ XYZ å¹³å°é‹å‹•æ§åˆ¶æ™¶ç‰‡è»Ÿç¡¬é«”è¨­è¨ˆæŠ€è¡“ 
å‡ºåœ‹äººå“¡å§“å 
æœå‹™æ©Ÿé—œåŠè·ç¨± 
é¾” æ‡‰ æ™‚ 
å—å°ç§‘æŠ€å¤§å­¸é›»æ©Ÿå·¥ç¨‹ç³»æ•™æˆ 
æœƒè­°æ™‚é–“åœ°é» 98/6/17 ~ 98/6/19 
 Guilin, China (ä¸­åœ‹æ¡‚ï§´) 
æœƒè­°åç¨± 
(ä¸­æ–‡) 2009 ï¦ä¸­åœ‹æ§åˆ¶åŠæ±ºç­–ç ”è¨æœƒ 
(è‹±æ–‡) Chinese Control and Decision Conference (2009 CCDC)   
ç™¼è¡¨ï¥æ–‡é¡Œç›® 
ç¬¬ä¸€ç¯‡:  
(ä¸­æ–‡)  ä»¥å¤šè™•ï§¤å™¨ SoPC ç‚ºåŸºç¤ XYZ å¹³å°é‹å‹•æ§åˆ¶å™¨ä¹‹ç ”è£½ 
 (è‹±æ–‡) Design and Implementation of a Motion Controller for XYZ 
Table based on Multiprocessor SoPC 
ç¬¬äºŒç¯‡:  
(ä¸­æ–‡)  ä»¥ DSP ç‚ºåŸºç¤ç„¡æ„Ÿæ¸¬å™¨æ°¸ç£åŒæ­¥é¦¬é”é©æ‡‰æ€§æ¨¡ç³Šæ§åˆ¶å™¨
ä¹‹ç ”è£½ 
 (è‹±æ–‡) DSP-based Adaptive Fuzzy Control for a Sensorless PMSM 
Drive 
 
ä¸€ã€ ï¥«åŠ æœƒè­°ç¶“é 
 
æœ¬äººæ­¤æ¬¡ï¥«åŠ çš„åœ‹éš›æœƒè­°ç‚ºä¸­åœ‹æ±ï¥£å¤§å­¸ä¸»è¾¦åŠæ–°åŠ å¡IEEE Industrial 
Electronicsåˆ†æ”¯å”è¾¦çš„ã€2009ï¦ä¸­åœ‹æ§åˆ¶åŠæ±ºç­–ç ”è¨æœƒã€(2009 Chinese Control 
and Decision Conference)ã€‚æœƒè­°æ™‚é–“ç‚º2009ï¦6æœˆ17è‡³19æ—¥ï¼Œæœƒè­°åœ°é»åœ¨ä¸­åœ‹å»£
è¥¿æ¡‚ï§´(Guilin, China)çš„æ¡‚å±±å¤§ï¨ªåº—(Guishan Hotel)èˆ‰è¾¦ã€‚æ­¤æœƒè­°ä¹‹ï¥æ–‡å°‡è¢«æ”¶
ï¤¿æ–¼IEEE ä¹‹è³‡ï¦¾åº«ä¸¦ä¸”ç‚ºEI Indexã€‚æ­¤æœƒè­°ä¹‹ï¥æ–‡åˆ†ç‚ºä¸‹ï¦œï§åˆ¥ï¼š  
1. Control and Decision : (æ§åˆ¶èˆ‡æ±ºç­–) 
 
 Adaptive control; Robust and H-infinity control; Process control; Variable 
structure control; Optimal control and optimization; Complex systems; Co-operative 
control; Identification and estimation; Nonlinear systems; Intelligent systems; 
Discrete event systems; Game theory; Decision-making theory and method; Decision 
 3
National University of Ireland Maynooth, Ireland. 
Plenary Lecture 3: "Cloud Simulation Platform" -----A New Networked 
Modeling & Simulation Platform Based on the Concept of 
Cloud Computing, by Professor Bohu Li, Beihang University, 
China. 
Plenary Lecture 4: Randomly Switching Systems: Models, Analysis, and 
Applications, by Professor Gang George Yin, College of Liberal 
Arts & Sciences Wayne State University, China. 
Semi-plenary Lecture 1: A unified approach to analysis and design of networked 
and quantized control systems, by Professor Dragan Nesic, 
University of Melbourne, Australia. 
Semi-plenary Lecture 2: Hybrid meta-heuristics based research on the planning 
and scheduling in the process industry, by Professor Lixin 
Tang, Northeastern University, China. 
Semi-plenary Lecture 3: Multi-agent control with multi-resolution sensing over 
networks, by Professor Geir E. Dullerud, University of Illinois 
at Urbana-Champaign, USA. 
Semi-plenary Lecture 4: Quantized Linear Quadratic Gaussian Control, by 
Professor Minyue Fu, University of Newcastle, UK. 
Semi-plenary Lecture 5: Recent Developments in Nonsmooth Feedback Control 
of Nonlinear System, by Professor Wei Lin, Case Western 
Reserve University, USA. 
Semi-plenary Lecture 6: Batch Process Control from Practice to 2D Model 
Predictive Control, by Professor Furong Gao, The Hong Kong 
University of Science and Technology, Hong Kong. 
Semi-plenary Lecture 7: Parametric Control Systems Design with Application in 
Missle Attitude Control, by Professor Guang-Ren Duan, 
Harbin Institute of Technology, China. 
Semi-plenary Lecture 8: Recent Advances on Stochastic Distribution Control: 
Probability Density Function Control, by Professor Hong 
Wang, University of Manchester, UK. 
Semi-plenary Lecture 9: Stochastic hybrid systems and their applications to 
networks and biology, by Professor JoÃ£o P. Hespanha, 
University of California, Santa Barbara, USA. 
Semi-plenary Lecture 10: Modelling and control of large-scale physical systems - 
challenges in reservoir engeering, by Professor Paul M. J. Van 
den Hof, Delft University of Technology, Netherlands. 
Semi-plenary Lecture 11: Low Gain and Low-and-High Gain Feedback: A 
Review and Some New Results, by Professor Zongli Lin, 
University of Virginia, USA. 
 5
æ…§å‹æ§åˆ¶ã€éŠæˆ²ï§¤ï¥ã€æ§åˆ¶ç³»çµ±èˆ‡æ‡‰ç”¨ã€é›»å‹•ï¤‚è¼›ã€æ©Ÿé›»æ•´åˆã€å¾®æ©Ÿé›»
ç³»çµ±ã€æ©Ÿå™¨è¦–è¦ºèˆ‡æœ€æ–°ç™¼å±•æŠ€è¡“ç­‰ï¼Œï¨¦æœ‰å¾ˆæ–°ç©çš„æŠ€è¡“å±•ç¾ã€‚ï¥§éï¼Œæ­¤
æœƒè­°ä¹‹ï¥æ–‡ 80%ç‚ºä¸­åœ‹å­¸è€…æ‰€ç™¼è¡¨ã€‚å› æ­¤ï¼Œï¥«åŠ æ­¤æœƒè­°å¯ä»¥å¾ˆå¿«ï¦ºè§£ä¸­
åœ‹åœ¨é€™äº›ï¦´åŸŸç›®å‰çš„ç™¼å±•æŠ€è¡“ï¼Œä¹Ÿå¯æä¾›åœ‹å…§å°ˆå®¶å­¸è€…åœ¨ç ”ç©¶æ–¹å‘ä¹‹ï¥«
è€ƒã€‚  
(äºŒ) æ­¤æ¬¡ CCDC 2009 æœƒè­°ä¸­ï¼Œç”±ç¾å ´è¨ï¥è¼ƒç‚ºç†±ï¦Ÿçš„ï¥æ–‡è©•å®šï¼Œæ‡‰ç¨ç‚ºåé‡
å¯¦å‹™æ‡‰ç”¨ä¹‹ï¥æ–‡ï¼Œè€Œå…¶ï¥æ–‡æ¶µè“‹ç›¸ç•¶å»£æ³›ï¼Œå› æ­¤ï¼ŒCCDC 2009 æœƒè­°é©åˆ
åœ‹å…§ç ”ç©¶é›»æ©Ÿèˆ‡é›»å­ä¹‹å­¸è€…æˆ–ç ”ç©¶ç”Ÿï¥«èˆ‡ã€‚ 
(ä¸‰) æ­¤æ¬¡ CCDC 2009 æœƒè­°å…±æœ‰ 1,233 ï¥æ–‡è¢«æ¥å—åœ¨æ­¤æœƒè­°ç™¼è¡¨ï¼Œå› æ­¤ç¸½è¨»å†Š
æœƒç›¸ç•¶å¯è§€ã€‚å› æ­¤ï¥§ç®¡åœ¨é‚€è«‹æ¼”è¬›ä¹‹å ´æ¬¡ï¼Œæœƒå ´ä¹‹ä½ˆç½®åŠè†³é£Ÿæ–¹é¢ï¼Œï¨¦
æ¯”è¼ƒè±å¯Œèˆ‡ï¨ç·»ã€‚ä¹Ÿç”±æ–¼ï¥æ–‡ç¯‡ï¥©å¤šï¼Œæ­¤æœƒè­°ä¹‹ï¥æ–‡ä¹Ÿè¼ƒè¢«æ”¶ï¤¿æ–¼ IEEE 
ä¹‹è³‡ï¦¾åº«ä¸¦ä¸”ç‚º EI Indexã€‚ç›¸å°çš„ï¼Œä¹Ÿç”±æ–¼å¯æ”¶ï¤¿æ–¼ IEEE ä¹‹è³‡ï¦¾åº«ä¸¦ä¸”
ç‚º EI Indexï¼ŒæŠ•ç¨¿çš„ï¥æ–‡ä¹Ÿè¼ƒè¸´èºã€‚ 
 
ä¸‰ã€ æ”œå›è³‡ï¦¾åç¨±åŠå…§å®¹ 
 
å¤§æœƒç ”è¨æœƒï¥æ–‡ CD ç‰‡åŠæ˜ï¦ï¨å„é …ç ”è¨æœƒè³‡ï¦¾ã€‚ 
 
1. INTRODUCTION 
Development of a high performance controller and servo 
system for precision XY table, CNC machine, etc. is a 
popular research work in literature [1-2]. In position control, 
there are two methods, which are semi-closed-loop control 
and full closed-loop control. The full closed-loop control 
algorithm, which is a signal of table position detected by a 
linear encoder and feedbacked for position control, had 
been proven a better position control method. 
Nowadays, the FPGA has brought more attention before. 
The advantages of the FPGA includes their programmable 
hard-wired feature, fast time-to-market, shorter design 
cycle, embedding processor, low power consumption and 
higher density for the implementation of the digital motor 
system; such as M.F. Tsai[3], D. Deng[4] adopted the 
CPLD and FPGA to develop the SVPWM scheme for 
inverter; Y. Y. Tzou[5], Y.S. Kung[6-7], etc, applied the 
FPGA to implement the vector control, current control and 
position control for the PMSM drive. Furthermore, the 
SoPC [8] and IP (Intellectual Property) designs can be 
developed and downloaded into FPGA with embedded 
processors to construct a multiprocessor SoPC environment. 
Using multiprocessor SoPC technology, the software and 
hardware co-design are reprogrammable and can be parallel 
processing in FPGA to increase the system performance 
and flexibility.  
In recent year, fuzzy control has been used to solve the 
control problem regarding as the parameter uncertainty and 
                                                          
This work is supported by National Science Council of the R.O.C. under 
grant no. NSC 97-2221-E-218 -055 
nonlinear system. Implementation of fuzzy control based on 
FPGA has the advantages of flexible design and fast 
computation; therefore, several researchers have been 
successfully used those techniques in the field of the servo 
control system. Such as, Li, T.S. [9] utilized an FPGA to 
implement the autonomous fuzzy behavior control on 
mobile robot. Lin, F.J. [10] presented a fuzzy sliding-mode 
control for a linear induction motor drive based on FPGA.  
Due to the advantage, a full close-loop control IC for XYZ 
table based on the multiprocessor SoPC technology is 
developed and shown in Fig.1. It has two modules in 
proposed motion control IC. One module is Nios-II 
multi-processor, which performs the function of trajectory 
planning and position control of XYZ table. The other 
module performs the function of three PMSMsâ€™ current 
loop control, that each includes SVPWM generation, 
coordinate transformation, PI controller and the pulse 
detection of the quadrature encoder. Therefore, all of the 
function needed to construct a full closed-loop control for 
XYZ table can be integrated and realized in an FPGA chip. 
Herein, FPGA adopts Altera Stratix II EP2S60F672C5ES 
[11-12], which has 48,352ALUTs, maximum 718 user I/O 
pins, 36 DSP blocks, total 2,544,192 RAM bits, and a Nios 
II embedded multi-processor which has a 32-bit 
configurable CPU core, 16 M byte Flash memory, 1 M byte 
SRAM and 16 M byte SDRAM, is used. Therefore, this 
FPGA chip is very suitable to develop a motion controller 
system for XYZ table. 
 
Design and Implementation of a Motion Controller for XYZ Table based on 
Multiprocessor SoPC 
Ying-Shieh Kung1, Tai-Wei Tsui1, Nan-Hui Shieh1 
1. Department of Electrical Engineering, Southern Taiwan University, Taiwan 
E-mail: kung@mail.stut.edu.tw  
 
Abstract: The new Field Programmable Gate Array (FPGA) technologies enables a Nios-II multi-processor and an 
application IP to be integrated into an SoPC (System-on-a-Programmable-Chip) developing environment. Therefore, 
this study presents a motion control IC for XYZ table under this SoPC environment. Each axis of XYZ table is driven by 
a Permanent magnetic Synchronous Motor (PMSM). In implementation, it has two modules in proposed motion control 
IC. One module is Nios-II multi-processor, which performs the function of trajectory planning and position control of 
XYZ table. The other module performs the function of three PMSMsâ€™ current loop control, that each includes SVPWM 
generation, coordinate transformation, PI controller and the pulse detection of the quadrature encoder. The former is 
implemented by software with C code in the Nios-II embedded multiprocessor. The latter is described by VHDL and 
implemented by hardware in FPGA. At last, to confirm the effectiveness of the proposed FPGA-based motion control IC 
for XYZ table, an experimental system with an XYZ table, an FPGA experimental board, a peripheral board for 
analog-to-digital transformation, three inverters and three rectifiers has been set up and some experimental results have 
been demonstrated. 
Key Words: XYZ Table, PMSM drives, FPGA, Fuzzy control, Multiprocessor SoPC. 
 
247978-1-4244-2723-9/09/$25.00 cÂ© 2009 IEEE
  
on the X-axis table, and send a measured position of the 
X-axis table to the main CPU. 
(c) The third CPU: perform the computation of the fuzzy 
control algorithm for Y-axis table, receive the Y-axis 
position command from main CPU and the QEP signal 
on the Y-axis table, and send a measured position of the 
Y-axis table to the main CPU. 
(d) The fourth CPU: perform the computation of the fuzzy 
control algorithm for Z-axis table, receive the Z-axis 
position command from main CPU and the QEP signal 
on the Z-axis table, and send a measured position of the 
Z-axis table to the main CPU. 
2.3   Fuzzy controller design 
The fuzzy controller in this study uses singleton fuzzifier, 
triangular membership function, product inference rule and 
central average defuzzifier method. In Fig. 1, the tracking 
error e  and the error change de  are defined by  
)()()( kskske rm   (4) 
)()()( 1kekekde   (5) 
and uf  represents the output of the fuzzy controller. Where 
the ms  and rs  are the position command and the measured 
displacement of the table, and s denotes X, Y or Z. The 
design procedure of the fuzzy controller is described as 
follows:  
(a) Take e, de as the input variable of fuzzy controller, and 
define their linguist variables as E and dE. The linguist 
value of E and dE are {A0, A1, A2, A3, A4, A5, A6} and 
{B0, B1, B2, B3, B4, B5, B6}, respectively. Each linguist 
value of E and dE are based on the symmetrical 
triangular membership function which is shown in 
Fig.2. The symmetrical triangular membership 
function are determined uniquely by three real 
numbers 321 			 

 , if one fixes 0ff 31  )()( 		  
and 1f 2 )(	 . With respect to the universe of 
discourse of [-6.6], the numbers for these linguistic 
values are selected as follows: 
A0=B0 : {-6,-6,-4},  A1=B1 : {-6,-4,-2}, A2=B2 : 
{-4,-2,0}, A3=B3: {-2,0,2},A4=B4 : {0,2,4}, A5=B5 : 
{2,4,6}, A6=B6: {4,6,6} (6) 
(b) Compute the membership degree of e and de. Figure 2(a) 
shows that the only two linguistic values are excited 
(resulting in a non-zero membership) in any input value, 
and the membership degree )(eAi  can be derived from 
Fig. 2(b), in which the error e is located between ei and 
ei+1, two linguist values of Ai and Ai+1 are excited, and 
the membership degree is obtained by 
    
2
eee 1iAi

 )(   and   )()( e1e i1i AA    (7) 
where )(* 1i26e 1i   . Similar results can be 
obtained in computing the membership degree )(deB j .  
(c) Select the initial fuzzy control rules by referring to the 
dynamic response characteristics, such as, 
ij,fji c  is  u  THEN   B is e  and  A is  e  IF   (8) 
where i and j = 0~6 and Ai and Bj are fuzzy number, and 
cj,i is a real number. The fuzzy rule table is shown in Fig. 
3.  
(d) Construct the fuzzy system uf(e,de) by using the 
singleton fuzzifier, product-inference rule, and central 
average defuzzifier method. Although there are total 49 
fuzzy rules in Fig. 3 will be inferred, actually only 4 
fuzzy rules can be effectively excited to generate a 
non-zero output. Therefore, if the error e is located 
between ei and ei+1, and the error change de is located 
between dej and dej+1, only four linguistic values Ai, Ai+1, 
Bj, Bj+1 and corresponding consequent values cj,i, cj+1,i, 
cj,i+1, cj+1,i+1 can be excited, and the (8) can be replaced 
by the following expression: 
m,n
i
in
j
jm
n,mi
in
j
jm
BA
i
in
j
jm
BAn,m
f d*c
)de(*)e(
)]de(*)e([c
)de,e(u
mn
mn


 










 
1 1
1 1
1 1
 

   (9) 
where )de(*)e( d
mn BAm,n
 . And those n,mc are adjustable 
parameters. In addition, by using (7), it is straightforward to 
obtain 1 d 
1i
in
1j
jm
mn  




,
 in (9). 
1
A0 A1 A2 A3 A4 A5 A6
0 6-6
e
(e)
42-4 -2
1
B0 B1 B2 B3 B4 B5 B6
0 6-6
de
(de)
42-4 -2
1
(e)
Ai Ai+1
ee
ei = -6+2*i ei+1 = -4+2*i
)(e
iA
)(e
1iA 
e de
(a)
(b)  
Fig. 2. (a) Membership function of error and error change 
(b) Membership degree 
c00
dE
1 A0 A1
A2 A3 A4 A5 A6
0 6-6
e
e
E
de
de
(e)
(
de
) 1
A3(e)
A4(e)=1- A3(e)
 B
1(
de
)
 B
2(
de
)=
1-
 B
1(
de
)
0
6
-6
Fuzzy Rule Table
Input of e  (for i=3)
In
pu
t o
f d
e 
 (f
or
 j=
1)
A0 A1 A2 A3 A4 A5 A6
c01 c02 c03 c04 c05 c06
c10 c11 c12 c13 c14 c15 c16
c20 c21 c22 c23 c24 c25 c26
c30 c31 c32 c33 c34 c35 c36
c40 c41 c42 c43 c44 c45 c46
c50 c51 c52 c53 c54 c55 c56
c60 c61 c62 c63 c64 c65 c66
B0
B1
B2
B3
B4
B5
B6
B 0
B 1
B 2
B 3
B 4
B 5
B 6
42-4 -2
4
2
-4
-2
 
Fig. 3 The fuzzification and fuzzy rule table 
3. MOTION TRAJECTORY OF XYZ TABLE  
3.1. One dimensional motion trajectory  
To smooth the table motion, a trajectory using a 
point-to-point motion control scheme with a trapezoidal 
constant acceleration/deceleration profile is adopted. In 
addition, in long distance motion, all axis in XYZ table is 
2009 Chinese Control and Decision Conference (CCDC 2009) 249
  
communication between main and others CPU adopts 
Avalon bus interface. Four CPUs operate with parallel 
which will speed up computational performance. The 
second module in FPGA performs the function of three 
PMSMsâ€™ current loop control, that each includes vector 
control, SVPWM generation, coordinate transformation, PI 
controller and the pulse detection of the quadrature encoder. 
Therefore, all of the function needed to construct a full 
closed-loop control for XYZ table can be integrated and 
realized in an FPGA chip. The clock frequency of the Nios 
II multi-processor is 50MHz, and the interrupt interval in 
position loop is designed with 1kHz. In this paper, FPGA 
chip adopts Altera Stratix II EP2S60F672C5ES, which has 
48,352ALUTs (equivalent 120,880LEs), maximum 718 
user I/O pins, 36 DSP blocks, total 2,544,192 RAM bits, 
and a Nios II embedded multi-processor which has a 32-bit 
configurable CPU core, 16 M byte Flash memory, 1 M byte 
SRAM and 16 M byte SDRAM, is used. A custom software 
development kit (SDK) consists of a compiled library of 
software routines for the SoPC design, a Make-file for 
rebuilding the library, and C header files containing 
structures for each peripheral. Finally, the FPGA utility of 
the motion control IC in Fig. 5 is evaluated and the result is 
listed in Table 1, which shows that the overall circuits of the 
proposed motion control IC included a Nios II embedded 
multi-processor IP (9,334 ALUTs and 192,512 RAM bits) 
and the three tablesâ€™ position control IP (9,422 ALUTs and 
239,616 RAM bits), use 38.7% ALUTs resource and 17% 
RAM resource of the Stratix II EP2S60F672C5ES.  
5. EXPERIMENTAL SYSTEM AND RESULTS 
The experimental system of the proposed motion control 
system for XYZ table is shown in Fig. 1. This system 
includes an FPGA experimental board, three sets of voltage 
source IGBT inverter and an XYZ table which is driven by 
three PMSMs and three ball-screws. The power, rating, 
voltage, current and rating speed of PMSM are 200W, 92V, 
1.6A and 3000rpm, respectively. A 2500 ppr rotary encoder 
attached to PMSM is used to measure the motorâ€™s electrical 
angle. The linear encoders with 5m resolution are 
mounted on the X-axis and Y-axis table as a position sensor. 
Each ball-screw has 5mm lead.  The inverter has 6 sets of 
IGBT type power transistors. The collector-emitter voltage 
of the IGBT is rating 600V, the gate-emitter voltage is 
rating Â±12V, and the collector current in DC is rating 25A 
and in short time (1ms) is 50A. The photo-IC, Toshiba 
TLP250, is used for gate driving circuit of IGBT. Input 
signals of the inverter are PWM signals from FPGA chip. 
In the experimental system, the PWM switching frequency 
of inverter is designed with 12k Hz, dead-band is 1s, and 
the sampling frequency in current loop and position loop of 
the PMSM are designed with 16kHz and 1kHz, 
respectively. 
To demonstrate the effectiveness of the proposed motion 
control IC, one-dimensional trapezoidal motion trajectory, 
two-dimensional circular and window motion trajectory, as 
well as the three-dimensional spiral motion trajectory are 
tested and its experimental tracking results are shown in 
Figs. 6 ~ 9. In Fig. 6, the overall displacement is designed 
with moving from 0 mm to 50 mm position and it maximum 
speed is 50mm/s. The result shows that the maximum 
tracking error is 0.5mm. In Figs. 7, the circular motion 
trajectory control with center (60, 60) mm and radius 50mm 
is evaluated and the tracking errors are the maximum 
 0.55 mm in X-axis, and  0.75 mm in Y-axis. The 
window motion trajectory control in Fig. 8 also shows the 
tracking errors maximum  0.5 mm in X-axis, and  0.9 
mm in Y-axis. Finally, the spiral motion trajectory with 
radius 40mm in X-Y plane and 100mm deep in Z-axis is 
evaluated, and its tracking errors are about  1.2 mm. 
Therefore, from the experimental results in Figs 6~9, those 
show that the motion trajectory for XYZ table can follows 
the trajectory command very well, and demonstrate that the 
proposal motion control IC using multi-processor SOPC is 
correctness and effectiveness. 
IDD[11..0]
IBB[11..0]
I-U[11..0]
IQQ[11..0]
IAA[11..0] I-W[11..0]
KP-q[11..0] VQQ[11..0]
VDD[11..0]
VAA[11..0]
VBB[11..0]
VA[11..0]
VC[11..0]
IQ[11..0]
IQQ[11..0]
PWM-f[11..0]
KI-q[11..0]
KP-p[11..0]
ID[11..0]
CLK-ctrl
IDD[11..0]
I-U[11..0]
I-W[11..0]
KI-p[11..0]
Encoder-A
SIN/COS
PI 
Controller
IQ[11..0]
STSB
RCB
RCA
STSA
CHB
CHA
SVPWM
ADC
Control
Modified
INV CLARK
CLARKPARK
INV PARK
QEP[15..0]
PI 
Controller
QEP
VB[11..0]
VC[11..0]
VB[11..0]
VA[11..0]
ID[11..0]=â€˜0â€™
Dead-band[11..0]
Estimation 
of Flux 
angle
rotor-position[15..0]
EN-Z
Flux-angle[11..0]
EN-A
EN-B
EN-ZEncoder-B
Encoder-Z
PWM-1
PWM-2
PWM-3
PWM-4
PWM-5
PWM-6
ADIN[11]
ADIN[10]
ADIN[9]
ADIN[8]
ADIN[7]
ADIN[6]
ADIN[5]
ADIN[4]
ADIN[3]
ADIN[2]
ADIN[1]
ADIN[0]
BDIN[11]
BDIN[10]
BDIN[9]
BDIN[8]
BDIN[7]
BDIN[6]
BDIN[5]
BDIN[4]
BDIN[3]
BDIN[2]
BDIN[1]
BDIN[0]
Servo on
Servo on
Servo on
CLK-ctrl
CLK-sys
CLK-sys
CLK-sys
CLK-sys
CLK -sys
CLK-sys
CLK-sys
CLK-sys
CLK-sys
CLK-ctrl
CLK-sys
CLK-sp
CLK-sys
CLK-sp
QEPx[15..0]
IQx[11..0]
QEP[15..0]
Altera FPGA (Stratix II EP2S60 )
CPU
On-chip
ROM
On-chip
RAM
UART
PIO
Timer
SPI
A
va
lo
n 
B
us
A
va
lo
n 
B
us
Nios Embedded Processor IP
sram_cs
sram_we
sram_oe
sram_be[3]
sram_be[2]
sram_be[1]
sram_be[0]
D[31]
D[0]
A[22]
A[0]
Encoder-A QEPEN-AEN-B
EN-ZEncoder-B
Encoder-Z
CLK-sys
CLK-sp
QEP[15..0]
EN-Z
QEP[15..0]
From Linear
Encoder
From Rotary
Encoder
X_STSB
X_RCB
X_RCA
X_STSA
X_CHB
X_CHA
X_PWM 1
X_PWM 2
X_PWM 5
X_PWM 3
X_PWM 4
X_PWM 6
X_ADIN[11]
X_ADIN[0]
X_BDIN[11]
X_BDIN[0]
CKCK
X_STSB
X_RCB
X_RCA
X_STSA
X_CHB
X_CHA
X_PWM 1
X_PWM 2
X_PWM 3
X_PWM 4
X_PWM 5
X_PWM 6
X_ADIN[11]
X_ADIN[0]
X_BDIN[11]
X_BDIN[0] Position control IP
for Z-Axis
Position control IP
for Y-Axis
Position control IP
for X-Axis
Clk
Clk-cur Frequency 
divider
CKClk-sp
QEPy[15..0]
IQy[11..0]
QEPz[15..0]
IQz[11..0]
A
va
lo
n 
B
us
A
va
lo
n 
B
us
Ê³
Fig.5.Architecture of the proposed motion control IC for XYZ Table  
Table 1 Utility evaluation of a motion control IC in FPGA  
01,610other
0159 *3ADC read in and transformation
Position control IP
(x-axis y-axis & z-
axis )
0105 * 3QEP detection and transformation
432,12818,756
01,339 *3SVPWM generation
79,872 *31,001 * 3Current vector control
Total
192,5129,334Nios II Embedded Processor IP
Memory
(bits)
ALUTsModule circuitIP
 
 
6. CONCLUSION 
This study adopts an Altera Stratix II EP2S60F672C5ES 
and a Nios-II multi-processor to build up a motion control 
IC for XYZ table. The trajectory planning and position loop 
2009 Chinese Control and Decision Conference (CCDC 2009) 251
 
1. INTRODUCTION 
Owing to the advantages of the superior power density, the 
high performance in speed control â€“ dynamic response and 
better accuracy, permanent magnet synchronous motors 
(PMSMs) have been used in many automation control 
fields as actuators [1]. Conventional motor control needs a 
speed sensor or an optical encoder to measure the rotor 
speed and feedback it to the controller for ensuring the 
precision speed control. However, such sensor presents 
some disadvantages such as drive cost, machine size, 
reliability and noise immunity [2]. In recent year, a 
sensorless control for PMSM drive become an important 
issue and variable sensorless control strategies have been 
investigated [2-5], such as, the sliding mode observer, the 
back EMF, Kalmam filter, the neural network, etc. 
However, the back EMF and the sliding mode observer are 
suitable to be implemented by the fix-pointed processor. In 
industrial applications, there are many uncertainties, such 
as system parameter uncertainties, external load 
disturbances, unmodeled uncertainties, etc. which always 
diminish the performance quality of the pre-design 
specification in the motor driving system. To solve this 
problem, intelligent control techniques [6-8] such as the 
fuzzy control, the neural networks control, the AFC, have 
been developed and applied to the speed control of servo 
motor drives to yield high operating performance. 
With rapid developments of the system-on-chip, a 
high-performance digital signal processor (DSP) has 
become a popular area of research in the field of the digital 
control [9] for ac drives because they exhibit high-speed 
performance, combine peripheral circuits, memory and 
                                                          
This work is supported by National Science Council of the R.O.C. under 
grant no. NSC 97-2221-E-218 -055 
have an optimized CPU structure on a single chip. In 
particular, the DSP controller TMS320F2812 [10] 
produced by Texas Instrument, which provides a high 
speed (150MIPS) computational power, up to 128Kx16 
flash, two sets (total 12 lines) of PWM outputs, two sets 
(total 4 lines) of QEP inputs, a 16-channels 12-bit A/D 
converter (200ns conversion time) and a 56-bits GPIO. 
Therefore, a complex control algorithm, such as the neural 
network control or the AFC, applied to servomotor to 
improve the dynamic performance become possible. 
Accordingly, in this work, a TMS320F2812 DSP controller 
used to realize a current vector control, a SVPWM (Space 
Vector Pulse Width Modulation) scheme, a flux angle and a 
rotor speed estimation scheme, an AFC, etc, has been 
developed for a sensorless PMSM drive. All software 
implemented in DSP is coded in C language. The excellent 
characteristic of the proposed DSP-based controller system 
makes the sensorless PMSM drive robust, well 
performance and easy to program. 
2. CONTROLLER DESIGN OF SENSORLESS 
PMSM DRIVE  
The architecture of the proposed speed controller applied in 
the sensorless PMSM drive is shown in Fig.1. In this figure, 
the functionalities of Park, Park-1, Clark, Clark-1, SVPWM, 
AD converter, PI current control, flux angle and rotor speed 
estimation, AFC etc. are all implemented in a DSP chip. 
Detailed design technologies are described as follows. 
2.1 Mathematical model of a PMSM drive 
PMSM is a coupled and nonlinear system. Under vector 
control in current loop, it will become a decoupled and 
linear system which likes DC motor. Generally, the 
mathematical model of the PMSM in d-q axis can be 
expressed by, 
 
DSP-based Adaptive Fuzzy Control for a Sensorless PMSM Drive  
Ying-Shieh Kung1, Ming-Shyan Wang2, Chung-Chun Huang3 
1,2. Department of Electrical Engineering, Southern Taiwan University, Taiwan 
E-mail: kung@mail.stut.edu.tw1  mswang@mail.stut.edu.tw2 
3. Energy & Environment Research Laboratory, Industrial Technology Research Institute, Taiwan 
E-mail: CCHuang@itri.org.tw 
 
Abstract: A study on DSP-based PMSM (Permanent Magnet Synchronous Motor) drive without the encoder sensor is 
presented in this work. In the sensorless technique, a flux angle estimator mainly constructed by a sliding mode observer 
is utilized to estimate the back electromotive force (EMF) and the flux angle, and indirectly compute and the rotor speed 
of the motor. These estimated values are feedback for vector control in the current loop and for speed control in the speed 
loop. To increase the performance of the speed controller, an adaptive fuzzy controller (AFC) consisted by a fuzzy 
controller, a reference model and an adjustable mechanism is applied; after that, the rules of the fuzzy controller can be 
online updated in real time. Finally, the TMS320F2812 DSP (Digital Signal Processor) is adopted to implement the 
aforementioned controllers. Combined a sensorless technique and an adaptive control technique into the speed controller 
of a PMSM drive make its performance be improved, the cost be reduced and the reliability be increased. 
Key Words: PMSM, DSP, Sliding mode observer, Sensorless technique, Adaptive fuzzy controller. 
2390978-1-4244-2723-9/09/$25.00 cÂ© 2009 IEEE
  
 Park  transformation: stationary - frame to 
synchronously rotating d-q frame. 
























f
f
f
f
ee
ee
qs
ds
cossin
sincos
  
(7) 
 1
Park  transformation: synchronously rotating d-q frame 
to stationary - frame. 











 







qs
ds
ee
ee
f
f
f
f




cossin
sincos
 
(8) 
In Fig.1, the PMSM will be decoupled if control id = 0; thus 
to control a PMSM is like to control a DC motor [1]. 
Considering the mechanical load term, the electrical and 
mechanical equations of PMSM can be written by the 
following equations. 
*
qie i KT   (9) 
Lermrm TTBdt
dJ 
	   (10) 
where eT , iK , mJ , mB  and LT  are motor toque, torque 
constant, inertial value, damping ratio and load toque, 
respectively. 
a
c
f
f
dsf
qsf
rotor
stator
Sf
e
e 
d
q 
axes rotatingsly synchronou  qd 

axes stationary   

axes stationary  cba 


b
 
Fig. 2. Transformation between stationary axes and synchronously rotating 
axes 
2.3  The estimation of a rotor flux angle 
A flux angle estimator constructed by a current observer, a 
bang-bang controller, a back EMF estimator and a flux 
angle calculation, is shown in Fig. 3. The feedback 
currents i , i  and the voltage commands v , v  are the 
inputs and the estimated flux angle eË†  is the output. When 
the estimated currents have a difference with the actual 
measured currents, the error will be used to drive the 
bang-bang controller. Then, the output of a bang-bang 
controller will regulate the back EMF value and force the 
estimated currents to follow the actual measured currents. 
From (4), the mathematic model of current observer is 
rearranged by the following equation 
 aaaa e-vBAiidt
d
	  (11) 
with
2
a
a I
L
R-A  , 2
a
I
L
1B  , ma L2
3L  ,  Ta iii  , 
 Ta vvv  and  Ta eee  . The Ra and Lm are 
winding resistance and inductance, respectively. The I2 is a 
2x2 unity matrix. Next, the sliding mode observer is used to 
the current observer in Fig.3, and the formulation is 
expressed as  
 ze-vBiAi
dt
d
a
*
aaa 		 Ë†Ë†Ë†  (12) 
Where  Ta iii  Ë†Ë†Ë†  ,  Ta eee  Ë†Ë†Ë†  ,  
 aa i-ikz Ë†sgn  (13) 
The sgn is defined as follows 
 
 
 







0i-i1-
0i-i0
0i-i1
aa
aa
aa
Ë†
Ë†
Ë†
sgn  (14) 
and 22Rk   is a gain matrix. In (13), the z is the output 
gain of the bang-bang controller for use to compensate a 
value to reduce the error between estimated current and 
measured current. In Fig. 3, the back EMF aeË†  is used to 
compute the flux angle eË† . To consider the noise effect, a 
low-pass filter is applied to estimate of back EMF, as 
follows, 
 a00a0a e-zze-edt
d Ë†Ë†Ë†  	  (15) 
where   eeea Ë†Ë†Ë†  , 00 f2    and 0f  is the cut-off 
frequency of the filter.  
In implementation, the above formulations in the 
continuous system have to transfer to the discrete system; 
therefore, the sliding mode current observer in (12) can be 
formulated to the difference equation by 
          nzne-nvGniF1ni a*aaa 			 Ë†Ë†Ë†  (16) 
where 2
T
L
R-
IeF
s
s
s
 , )( s
s T
L
R-
s
e-1
R
1G   and sT  is the sampling 
time. In addition, the difference equation of the back EMF 
estimator can also be expressed by  
        ne-nzf2ne1ne a0aa Ë†Ë†Ë†  		  (17) 
Once the back EMF is estimated, the flux angle can be 
computed as,  
eef sin-e  Ë†Ë†   (18) 
eef cose  Ë†Ë†   (19) 
and the magnet angle eË†  can be directly computed by 
!
"
#
$
%
&

 e
e- tan 1-e Ë†
Ë†Ë†  (20) 
É 
e
Current
Observer
(12)
Bang-Bang
Control
(13)
PMSM
Low-pass
Filter
(15)
Flux angle
Calculation
(20)É 
É¡
É  É 
É¡











i~
i~
i~a









i
i
ia









v
v
va

av
z









e~
e~
e~a
ae~ e
~
Rotor Flux Position Estimator
Back EMF Observer
 
Fig. 3. Architecture of a rotor flux angle estimator 
2392 2009 Chinese Control and Decision Conference (CCDC 2009)
  
optical encoder (1000 ppr) attached to PMSM is used to 
recheck the accuracy and correctness of the estimated 
rotor speed.  
 Inverter : The inverter has 6 sets of IGBT type power 
transistors.!The collector-emitter voltage of the IGBT is 
rating 600V, the gate-emitter voltage is rating!320V, and 
the collector current in DC is rating 25A and in short time 
(1ms) is 50A. The photo-IC, Toshiba TLP250, is used for 
gate driving circuit of IGBT. Input signals of the inverter 
are PWM signals from DSP chip.  
 DSP Controller : The DSP controller TMS320F2812  
produced by Texas Instrument, which provides the high 
speed (150MIPS) computational power, up to 128Kx16 
flash, two sets (total 12 lines) of PWM outputs, two sets 
(total 4 lines) of QEP inputs, a 16-channels 12-bit A/D 
converter (200ns conversion time) and a 56-bits GPIO. 
In Fig.1, a current vector control scheme, a SVPWM 
generation, two A/Ds conversion, the coordinate 
transformation, a rotor speed estimation and an 
intelligent fuzzy control strategy are all realized by the 
software in DSP chip. The PWM switching frequency of 
inverter is designed with 16k Hz, dead-band is 1-s, and 
the control sampling frequency of current and speed 
loop are 16kHz and 1kHz, respectively. The flow chart 
of main program and the interrupt service routine for 
digital motor control algorithm are designed and shown 
in Fig. 6. Those programs are coded with C language, 
the computation time in DSP for executing current loop 
and AFC algorithm of speed loop is 25 -s.  
IGBT 
(or IPM)
UP VP WP UN VN WN
Protection logic circuit
TLP250
TMS320F2812 DSP Controller
PWM1  ~  PWM6
U
V
W
PMSM
Current 
sensor
LP filter
AD1 AD2
LP filter
L
C
Rectifier
ac 
source
P
N
 
Fig. 4. DSP-based  sensorless PMSM driving system 
 
Fig. 5. The DSP-based experimental system for sensorless PMSM drive 
Start of 
main program
Initial interrupt
Initial timer 1,
QEP,ADC etc.
Setting of
PWM Mode
Setting of 
speed command
loop
Start of  ISR
(each 16kHz)
Read iu , iw current
from ADC
Park & Clark 
transformation
Calculation of 
current error of 
PI controller
Park-1 & Clark-1
transformation
Calculation of
SVPWM scheme
and PWM output
(each 500Hz)
(each 16kHz)
Return
yes
no
Estimate rotor 
Position from
Sliding mode observer
Speed control
model ?
Calculation of 
speed error of 
Adaptive Fuzzy 
controller
Estimate rotor speed
Calculation of
q-axis current 
command
Get reference speed
of model reference 
19.8Ó´s
 
Fig. 6. The flow chart of the main and interrupt program in DSP 
3.2 Experimental results 
In the implementation, the PWM frequency, dead-band, 
current loop sampling frequency, speed loop sampling 
frequency in PMSM drive are designed with 16 kHz, 1 -s, 
16 kHz and 500 Hz, respectively. The cut-off frequency of 
low-pass filter for back EMF estimator in Fig. 3 is set to be 
50Hz. In the experiment of the flux angle estimation, the 
running PMSM are tested in the condition of 60rpm (4Hz 
flux rotation frequency), 300rpm (20Hz) and 1200 rpm (80 
Hz). To evaluate the correctness of the measured flux angle, 
an encoder attached to the PMSM is adopted to measure the 
rotor flux position for comparing the accuracy of the 
estimated value; and the experiment results are shown in 
Figs. 7~9. In Figs. 7~8, the PMSM runs at 60 rpm and 300 
rpm and the estimated flux angle has 30Â° and 7Â°phase error 
compared with the measured value by encoder sensor, 
respectively. However, the PMSM runs at 1200 rpm in 
Fig.9, the estimated flux angle almost match the measured 
value by encoder sensor. The experiment results show that 
the method of sliding mode current observer applied to 
estimate the flux angle is suitable for a moderate or a high 
speed motor running. At a low speed of the motor rotor, the 
weak back EMF signal will affect the accuracy of the flux 
position. After confirming the correctness of the sensorless 
flux estimation, and further, the vector control and AFC are 
applied to the current loop and speed loop, respectively, for 
improving the speed control performance. Then the 0.5 Hz 
square wave with amplitude varying between 300-600, 
600-900 and 900-1200 rpm are used as the tested command 
signal. The experimental rotor speed responses 
corresponding with aforementioned command under 
without encoder sensor are shown in Fig.10 to Fig.12. The 
results show that all the rotor speed track the output of 
reference model well after 1-2 period square wave 
command in different running speed condition of the 
PMSM. Thus, the experiments in Figs. 7~12 demonstrate 
that our proposed DSP-based sensorless PMSM drive 
control system using AFC is effectiveness and correctness. 
2394 2009 Chinese Control and Decision Conference (CCDC 2009)
